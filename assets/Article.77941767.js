var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,a=(t,n,r)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r,s=(e,t)=>{for(var n in t||(t={}))o.call(t,n)&&a(e,n,t[n]);if(r)for(var n of r(t))i.call(t,n)&&a(e,n,t[n]);return e},l=(e,r)=>t(e,n(r)),c=("undefined"!=typeof require&&require,(e,t,n)=>(a(e,"symbol"!=typeof t?t+"":t,n),n)),u=(e,t,n)=>new Promise(((r,o)=>{var i=e=>{try{s(n.next(e))}catch(t){o(t)}},a=e=>{try{s(n.throw(e))}catch(t){o(t)}},s=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,a);s((n=n.apply(e,t)).next())}));import{o as d,c as p,R as h,r as f,a as g,q as m,u as v,s as y,x as S,y as w,z as x,D as E,E as C,F as b,G as R,H as _,I as k,J as T,K as L}from"./vendor.9cecd84c.js";import{i as N,_ as I,C as H,T as P,d as z,M as B,R as D,a as O,L as M,g as j,c as V,I as q}from"./propTypes.6a7638d0.js";import{m as W,s as F}from"./index.bcb53b00.js";function Y(e){return u(this,arguments,(function*({title:e,body:t,tagList:n,description:r}){try{const o=yield N.post("/articles",{article:{title:e,body:t,tagList:n,description:r}},{loading:!0});if(200!==o.status)throw new Error("失败");return o.data.article.slug}catch(o){return""}}))}function A(e){return u(this,arguments,(function*({slug:e}){try{return(yield N.get(`/articles/${e}`,{loading:!0})).data.article||{}}catch(t){return{}}}))}var U=d(p.exports.createElement("path",{d:"M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"})),Q=d(p.exports.createElement("path",{d:"M21.99 4c0-1.1-.89-2-1.99-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h14l4 4-.01-18zM18 14H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"})),$=d(p.exports.createElement("path",{d:"M2 20h2c.55 0 1-.45 1-1v-9c0-.55-.45-1-1-1H2v11zm19.83-7.12c.11-.25.17-.52.17-.8V11c0-1.1-.9-2-2-2h-5.5l.92-4.65c.05-.22.02-.46-.08-.66-.23-.45-.52-.86-.88-1.22L14 2 7.59 8.41C7.21 8.79 7 9.3 7 9.83v7.84C7 18.95 8.05 20 9.34 20h8.11c.7 0 1.36-.37 1.72-.97l2.66-6.15z"}));const X=W((e=>({favouriteStyle:{fontSize:"14px",color:e.fc.active},unFavouriteStyle:{fontSize:"14px",color:e.fc.desc}})));function K({favoritesCount:e=0,favorited:t=!1,slug:n=""}){const r=X(),[o,i]=p.exports.useState(e),[a,s]=p.exports.useState(t);p.exports.useEffect((()=>{i(e)}),[e]),p.exports.useEffect((()=>{s(t)}),[t]);const l=p.exports.useCallback((e=>u(this,null,(function*(){e.stopPropagation(),a?(yield function(t){return u(this,arguments,(function*({slug:t}){try{if(200!==(yield N.delete(`/articles/${t}/favorite`,{loading:!0})).status)throw new Error("点赞失败");return 1}catch(e){return-1}}))}({slug:n}))>0&&(i(o-1),s(!1)):(yield function(t){return u(this,arguments,(function*({slug:t}){try{if(200!==(yield N.post(`/articles/${t}/favorite`,{},{loading:!0})).status)throw new Error("点赞失败");return 1}catch(e){return-1}}))}({slug:n}))>0?(I.info("点赞成功"),i(o+1),s(!0)):I.info("点赞失败")}))),[a]);return h.createElement(H,{className:"f-r a-center",onClick:l,style:a?r.favouriteStyle:r.unFavouriteStyle},h.createElement($,{style:{fontSize:"14px",marginRight:"4px"}})," ",o)}const G=W((e=>({icon1:{fontSize:"14px",marginRight:"4px"},action:{flex:1,boxSizing:"border-box",paddingLeft:"16px"},publishBtn:{backgroundColor:e.fc.active,height:"24px",lineHeight:"24px",padding:"0 16px",borderRadius:"12px",color:"#fff",fontSize:"12px"},mask:{height:window.innerHeight+"px",width:"100vw",position:"fixed",top:0,bottom:0,backgroundColor:"rgba(0,0,0,0.15)"},commentBar:{position:"fixed",boxSizing:"border-box",bottom:0,left:0,zIndex:3001,width:"100vw",padding:"8px 12px",backgroundColor:e.bg.pri}})));function J({data:e,updateComments:t,commentCount:n}){const[r,o]=p.exports.useState(!1),i=G();return h.createElement("div",{className:"f-r a-center article-underbar"},h.createElement(H,{className:"fake-input",onClick:()=>o(!0)},"说点什么吧"),h.createElement("div",{className:"f-r j-around a-center",style:i.action},h.createElement("div",{className:"f-r"},h.createElement(Q,{style:i.icon1}),n),h.createElement(K,s({},e)),h.createElement("div",null,h.createElement(U,{style:i.icon1,onClick:Z})),r?h.createElement(ee,s({updateComments:t,onMaskClose:()=>o(!1)},e)):null))}function Z(){I.info("得要微信号分享,我再想想咋整")}function ee({onMaskClose:e,slug:t,updateComments:n}){const r=G(),[o,i]=p.exports.useState("");return f.exports.useUnactivate((()=>{e()})),g.createPortal(h.createElement("div",{style:r.mask,onClick:e},h.createElement("div",{style:r.commentBar,onClick:e=>e.stopPropagation()},h.createElement(P,{value:o,onChange:i,rows:3}),h.createElement("div",{className:"f-r j-end",style:{marginTop:"8px"}},h.createElement("div",{style:r.publishBtn,onClick:function(){return u(this,null,(function*(){if(!o)return;(yield function(e){return u(this,arguments,(function*({slug:e,body:t}){try{if(200!==(yield N.post(`/articles/${e}/comments`,{comment:{body:t}},{loading:!0})).status)throw new Error("失败");return 1}catch(n){return-1}}))}({slug:t,body:o}))>0?(I.success("发表成功"),n(),e()):I.fail("发表失败")}))}},"发表")))),document.body)}let te=0;function ne(e){var t=e,{src:n}=t,a=((e,t)=>{var n={};for(var a in e)o.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&r)for(var a of r(e))t.indexOf(a)<0&&i.call(e,a)&&(n[a]=e[a]);return n})(t,["src"]);const[l,c]=p.exports.useState(!1),u=p.exports.useRef(null),d=p.exports.useRef(-1),f=p.exports.useCallback((()=>{var e,t;d.current===(null==(t=null==(e=u.current)?void 0:e.dataset)?void 0:t.errtoken)&&c(!1)}),[d.current]);return p.exports.useEffect((()=>{const e=te++;u.current&&(u.current.dataset.errtoken=e),d.current=e,c(!0)}),[n]),h.createElement("img",s({ref:u,src:l?z:n,onError:f},a))}const re=W((e=>({root:{marginTop:"16px"},jiange:{height:"8px",width:"100vw",margin:"0 -16px",backgroundColor:e.bg.sec},divider:{width:"100vw",margin:"0 -16px"},header:{height:"36px",lineHeight:"36px",backgroundColor:"rgba(0,0,0,0.07)",width:window.innerWidth-32+"px",margin:"0 -16px",padding:"0 16px",fontWeight:600,color:e.fc.header},rowItem:{padding:"16px 0",position:"relative"},avatar:{marginRight:"8px"},uname:{color:e.fc.header,fontSize:"14px",fontWeight:800},body:{fontSize:"12px",marginTop:"8px",color:e.fc.text},empty:{padding:"16px 0",color:e.fc.text},delBtn:{color:e.fc.active,position:"absolute",right:"8px",top:"16px"}})));var oe=m((e=>({uinfo:e.app.uinfo})))((function({comments:e,uinfo:t,slug:n,updateComments:r}){const o=re();return h.createElement("div",{style:o.root},h.createElement("div",{style:o.jiange}),h.createElement("div",{style:o.header},"评论(",e.length,")"),e.length>0?h.createElement("div",null,e.map((e=>h.createElement(h.Fragment,{key:e.id},h.createElement(ie,{data:e,username:t.username,slug:n,updateComments:r}),h.createElement("div",{className:"divider",style:o.divider}))))):h.createElement(ae,null))}));function ie({data:e,username:t,slug:n,updateComments:r}){var o,i,a;console.log(t);const s=re(),l=v();return h.createElement("div",{className:"f-r",style:s.rowItem},h.createElement("div",{style:s.avatar},h.createElement(ne,{src:null==(o=null==e?void 0:e.author)?void 0:o.image,className:"user-img",alt:"",onClick:t=>{var n;t.stopPropagation(),l.push(`/profile/${null==(n=null==e?void 0:e.author)?void 0:n.username}`)}})),h.createElement("div",null,h.createElement("div",{style:s.uname,onClick:t=>{var n;t.stopPropagation(),l.push(`/profile/${null==(n=null==e?void 0:e.author)?void 0:n.username}`)}},null==(i=null==e?void 0:e.author)?void 0:i.username),h.createElement("div",{style:s.body},e.body)),t===(null==(a=null==e?void 0:e.author)?void 0:a.username)?h.createElement("div",{style:s.delBtn,onClick:function(){B.alert("提示","你要删除评论吗?",[{text:"算了",onPress:()=>console.log("cancel"),style:"default"},{text:"删除",onPress:()=>u(this,null,(function*(){(yield function(e){return u(this,arguments,(function*({slug:e,id:t}){try{const n=yield N.delete(`/articles/${e}/comments/${t}`,{loading:!0});if(n.status<200||n.status>300)throw new Error("失败");return 1}catch(n){return-1}}))}({slug:n,id:e.id}))<0?I.fail("删除失败"):(I.success("删除成功"),r())}))}])}},"删除"):h.createElement("div",{style:s.delBtn},"关注"))}function ae(){const e=re();return h.createElement("div",{style:e.empty},"内容为空")}const se=W((e=>({root:{height:window.innerHeight+"px",backgroundColor:e.bg.pri,overflowY:"scroll"},userImg:{display:"inline-block",marginRight:"14px"},article:{padding:"0 16px",paddingBottom:"56px"},articleContent:{marginTop:"24px"},guanzhu:{color:e.fc.header}})));function le(e){var t,n,r,o;const i=se(),a=v(),[s,l]=p.exports.useState({}),[c,d]=p.exports.useState([]),f=p.exports.useRef(null),g=p.exports.useRef(null),m=p.exports.useMemo((()=>c.length),[c]);p.exports.useEffect((()=>{S(),w()}),[]);const y=p.exports.useMemo((()=>Object.keys(s).length>0),[s]),S=p.exports.useCallback((()=>u(this,null,(function*(){var t,n;const r=null==(n=null==(t=null==e?void 0:e.match)?void 0:t.params)?void 0:n.slug;r&&l(yield A({slug:r}))}))),[]),w=p.exports.useCallback((()=>u(this,null,(function*(){var t,n;const r=null==(n=null==(t=null==e?void 0:e.match)?void 0:t.params)?void 0:n.slug;r&&d(yield function(e){return u(this,arguments,(function*({slug:e}){try{return(yield N.get(`/articles/${e}/comments`)).data.comments||[]}catch(t){return[]}}))}({slug:r})),localStorage.getItem("gotoComment")&&f.current&&f.current.scrollTo({top:g.current?g.current.getBoundingClientRect().top:0})}))),[]);return h.createElement("div",{className:"rvt-headerview article-detail",style:i.root,ref:f},h.createElement(D,null),y?h.createElement("div",{style:i.article},h.createElement("div",{className:"title"},s.title),h.createElement("div",{className:"f-r j-between a-center"},h.createElement("div",{className:"f-r a-center"},h.createElement(ne,{className:"user-img",src:null==(t=null==s?void 0:s.author)?void 0:t.image,style:i.userImg,onClick:e=>{var t;e.stopPropagation(),a.push(`/profile/${null==(t=null==s?void 0:s.author)?void 0:t.username}`)}}),h.createElement("div",null,h.createElement("div",{className:"header",onClick:e=>{var t;e.stopPropagation(),a.push(`/profile/${null==(t=null==s?void 0:s.author)?void 0:t.username}`)}},(null==(n=null==s?void 0:s.author)?void 0:n.username)||"示例昵称"),h.createElement("div",{className:"secd"},s.updateAt||"1小时前")))),h.createElement("div",{className:"content",style:i.articleContent},s.body),h.createElement("div",{ref:g},h.createElement(oe,{comments:c,slug:null==(o=null==(r=null==e?void 0:e.match)?void 0:r.params)?void 0:o.slug,updateComments:w})),h.createElement(J,{data:s,commentCount:m,updateComments:w})):null)}var ce=d(p.exports.createElement("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}));var ue=function(e,t,n,r,o,i,a,s){if(!e){var l;if(void 0===t)l=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var c=[n,r,o,i,a,s],u=0;(l=new Error(t.replace(/%s/g,(function(){return c[u++]})))).name="Invariant Violation"}throw l.framesToPop=1,l}},de=ue;var pe=function(e){if(Array.isArray(e))return 0===e.length;if("object"==typeof e){if(e)for(var t in!function(e){if("undefined"==typeof Symbol)return!1;return e[Symbol.iterator]}(e)||void 0===e.size||de(!1),e)return!1;return!0}return!e},he=function(){};function fe(e,t,n){return e[t][n]}function ge(e,t){return e[t]}var me=function(){function e(t){S(this,e),ue(t&&"function"==typeof t.rowHasChanged,"Must provide a rowHasChanged function."),this._rowHasChanged=t.rowHasChanged,this._getRowData=t.getRowData||fe,this._sectionHeaderHasChanged=t.sectionHeaderHasChanged,this._getSectionHeaderData=t.getSectionHeaderData||ge,this._dataBlob=null,this._dirtyRows=[],this._dirtySections=[],this._cachedRowCount=0,this.rowIdentities=[],this.sectionIdentities=[]}return y(e,[{key:"cloneWithRows",value:function(e,t){var n=t?[t]:null;return this._sectionHeaderHasChanged||(this._sectionHeaderHasChanged=function(){return!1}),this.cloneWithRowsAndSections({s1:e},["s1"],n)}},{key:"cloneWithRowsAndSections",value:function(t,n,r){ue("function"==typeof this._sectionHeaderHasChanged,"Must provide a sectionHeaderHasChanged function with section data."),ue(!n||!r||n.length===r.length,"row and section ids lengths must be the same");var o=new e({getRowData:this._getRowData,getSectionHeaderData:this._getSectionHeaderData,rowHasChanged:this._rowHasChanged,sectionHeaderHasChanged:this._sectionHeaderHasChanged});return o._dataBlob=t,o.sectionIdentities=n||Object.keys(t),r?o.rowIdentities=r:(o.rowIdentities=[],o.sectionIdentities.forEach((function(e){o.rowIdentities.push(Object.keys(t[e]))}))),o._cachedRowCount=function(e){for(var t=0,n=0;n<e.length;n++){t+=e[n].length}return t}(o.rowIdentities),o._calculateDirtyArrays(this._dataBlob,this.sectionIdentities,this.rowIdentities),o}},{key:"getRowCount",value:function(){return this._cachedRowCount}},{key:"getRowAndSectionCount",value:function(){return this._cachedRowCount+this.sectionIdentities.length}},{key:"rowShouldUpdate",value:function(e,t){return this._dirtyRows[e][t]}},{key:"getRowData",value:function(e,t){var n=this.sectionIdentities[e],r=this.rowIdentities[e][t];return this._getRowData(this._dataBlob,n,r)}},{key:"getRowIDForFlatIndex",value:function(e){for(var t=e,n=0;n<this.sectionIdentities.length;n++){if(!(t>=this.rowIdentities[n].length))return this.rowIdentities[n][t];t-=this.rowIdentities[n].length}return null}},{key:"getSectionIDForFlatIndex",value:function(e){for(var t=e,n=0;n<this.sectionIdentities.length;n++){if(!(t>=this.rowIdentities[n].length))return this.sectionIdentities[n];t-=this.rowIdentities[n].length}return null}},{key:"getSectionLengths",value:function(){for(var e=[],t=0;t<this.sectionIdentities.length;t++)e.push(this.rowIdentities[t].length);return e}},{key:"sectionHeaderShouldUpdate",value:function(e){return this._dirtySections[e]}},{key:"getSectionHeaderData",value:function(e){if(!this._getSectionHeaderData)return null;var t=this.sectionIdentities[e];return this._getSectionHeaderData(this._dataBlob,t)}},{key:"_calculateDirtyArrays",value:function(e,t,n){for(var r,o=ve(t),i={},a=0;a<n.length;a++){var s=t[a];he(!i[s]),i[s]=ve(n[a])}this._dirtySections=[],this._dirtyRows=[];for(var l=0;l<this.sectionIdentities.length;l++){r=!o[s=this.sectionIdentities[l]];var c=this._sectionHeaderHasChanged;!r&&c&&(r=c(this._getSectionHeaderData(e,s),this._getSectionHeaderData(this._dataBlob,s))),this._dirtySections.push(!!r),this._dirtyRows[l]=[];for(var u=0;u<this.rowIdentities[l].length;u++){var d=this.rowIdentities[l][u];r=!o[s]||!i[s][d]||this._rowHasChanged(this._getRowData(e,s,d),this._getRowData(this._dataBlob,s,d)),this._dirtyRows[l].push(!!r)}}}}]),e}();function ve(e){if(pe(e))return{};for(var t={},n=0;n<e.length;n++){var r=e[n];he(!t[r]),t[r]=!0}return t}var ye={className:w.string,prefixCls:w.string,listPrefixCls:w.string,listViewPrefixCls:w.string,style:w.object,contentContainerStyle:w.object,onScroll:w.func},Se=function(e){function t(){var e,n,r;S(this,t);for(var o=arguments.length,i=Array(o),a=0;a<o;a++)i[a]=arguments[a];return n=r=E(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),we.call(r),E(r,n)}return x(t,e),y(t,[{key:"componentWillUpdate",value:function(e){this.props.dataSource===e.dataSource&&this.props.initialListSize===e.initialListSize||!this.handleScroll||(this.props.useBodyScroll?window.removeEventListener("scroll",this.handleScroll):this.ScrollViewRef.removeEventListener("scroll",this.handleScroll))}},{key:"componentDidUpdate",value:function(e){var t=this;this.props.dataSource===e.dataSource&&this.props.initialListSize===e.initialListSize||!this.handleScroll||setTimeout((function(){t.props.useBodyScroll?window.addEventListener("scroll",t.handleScroll):t.ScrollViewRef.addEventListener("scroll",t.handleScroll)}),0)}},{key:"componentDidMount",value:function(){var e,t,n,r,o=this,i=function(e){return o.props.onScroll&&o.props.onScroll(e,o.getMetrics())};this.props.scrollEventThrottle&&(e=i,t=this.props.scrollEventThrottle,n=!0,r=!0,i=function(o){n&&(n=!1,setTimeout((function(){n=!0,e(o)}),t),r&&(e(o),r=!1))}),this.handleScroll=i,this.onLayout=function(){return o.props.onLayout({nativeEvent:{layout:{width:window.innerWidth,height:window.innerHeight}}})},this.props.useBodyScroll?(window.addEventListener("scroll",this.handleScroll),window.addEventListener("resize",this.onLayout)):this.ScrollViewRef.addEventListener("scroll",this.handleScroll)}},{key:"componentWillUnmount",value:function(){this.props.useBodyScroll?(window.removeEventListener("scroll",this.handleScroll),window.removeEventListener("resize",this.onLayout)):this.ScrollViewRef.removeEventListener("scroll",this.handleScroll)}},{key:"render",value:function(){var e=this,t=this.props,n=t.children,r=t.className,o=t.prefixCls,i=t.listPrefixCls,a=t.listViewPrefixCls,s=t.style,l=void 0===s?{}:s,c=t.contentContainerStyle,u=void 0===c?{}:c,d=t.useBodyScroll,p=t.pullToRefresh,f=o||a||"",g={ref:function(t){return e.ScrollViewRef=t||e.ScrollViewRef},style:C({},d?{}:{position:"relative",overflow:"auto",WebkitOverflowScrolling:"touch"},l),className:b(r,f+"-scrollview")},m={ref:function(t){return e.InnerScrollViewRef=t},style:C({position:"absolute",minWidth:"100%"},u),className:b(f+"-scrollview-content",i)},v=function(t){return h.cloneElement(p,{getScrollContainer:t?function(){return document.body}:function(){return e.ScrollViewRef}},n)};return d?p?h.createElement("div",g,v(!0)):h.createElement("div",g,n):p?h.createElement("div",g,h.createElement("div",m,v())):h.createElement("div",g,h.createElement("div",m,n))}}]),t}(h.Component);Se.propTypes=ye;var we=function(){var e=this;this.getMetrics=function(){var t=!e.props.horizontal;if(e.props.useBodyScroll){var n=document.scrollingElement?document.scrollingElement:document.body;return{visibleLength:window[t?"innerHeight":"innerWidth"],contentLength:e.ScrollViewRef?e.ScrollViewRef[t?"scrollHeight":"scrollWidth"]:0,offset:n[t?"scrollTop":"scrollLeft"]}}return{visibleLength:e.ScrollViewRef[t?"offsetHeight":"offsetWidth"],contentLength:e.ScrollViewRef[t?"scrollHeight":"scrollWidth"],offset:e.ScrollViewRef[t?"scrollTop":"scrollLeft"]}},this.getInnerViewNode=function(){return e.InnerScrollViewRef},this.scrollTo=function(){var t;e.props.useBodyScroll?(t=window).scrollTo.apply(t,arguments):(e.ScrollViewRef.scrollLeft=arguments.length<=0?void 0:arguments[0],e.ScrollViewRef.scrollTop=arguments.length<=1?void 0:arguments[1])}},xe=function(e){function t(){return S(this,t),E(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return x(t,e),y(t,[{key:"shouldComponentUpdate",value:function(e){return e.shouldUpdate}},{key:"render",value:function(){return this.props.render()}}]),t}(h.Component),Ee=function(e){function t(){var e,n,r;S(this,t);for(var o=arguments.length,i=Array(o),a=0;a<o;a++)i[a]=arguments[a];return n=r=E(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),Ce.call(r),E(r,n)}return x(t,e),y(t,[{key:"componentWillMount",value:function(){this.scrollProperties={visibleLength:null,contentLength:null,offset:0},this._childFrames=[],this._visibleRows={},this._prevRenderedRowsCount=0,this._sentEndForContentLength=null}},{key:"componentWillReceiveProps",value:function(e){var t=this;this.props.dataSource===e.dataSource&&this.props.initialListSize===e.initialListSize||this.setState((function(n,r){return t._prevRenderedRowsCount=0,{curRenderedRowsCount:Math.min(Math.max(n.curRenderedRowsCount,e.initialListSize),e.dataSource.getRowCount())}}),(function(){return t._renderMoreRowsIfNeeded()}))}},{key:"render",value:function(){for(var e=this,t=this.props.dataSource,n=t.rowIdentities,r=[],o=0,i=0;i<n.length;i++){var a=t.sectionIdentities[i],s=n[i];if(0!==s.length){var l=void 0;if(this.props.renderSectionHeader){var c=o>=this._prevRenderedRowsCount&&t.sectionHeaderShouldUpdate(i);l=h.createElement(xe,{key:"s_"+a,shouldUpdate:!!c,render:this.props.renderSectionHeader.bind(null,t.getSectionHeaderData(i),a)})}for(var u=[],d=0;d<s.length;d++){var p=s[d],f=a+"_"+p,g=o>=this._prevRenderedRowsCount&&t.rowShouldUpdate(i,d),m=h.createElement(xe,{key:"r_"+f,shouldUpdate:!!g,render:this.props.renderRow.bind(null,t.getRowData(i,d),a,p,this.onRowHighlighted)});if(u.push(m),this.props.renderSeparator&&(d!==s.length-1||i===n.length-1)){var v=this.state.highlightedRow.sectionID===a&&(this.state.highlightedRow.rowID===p||this.state.highlightedRow.rowID===s[d+1]),y=this.props.renderSeparator(a,p,v);y&&u.push(y)}if(++o===this.state.curRenderedRowsCount)break}var S=h.cloneElement(this.props.renderSectionBodyWrapper(a),{className:this.props.sectionBodyClassName},u);if(this.props.renderSectionWrapper?r.push(h.cloneElement(this.props.renderSectionWrapper(a),{},l,S)):(r.push(l),r.push(S)),o>=this.state.curRenderedRowsCount)break}}var w=this.props,x=w.renderScrollComponent,E=O(w,["renderScrollComponent"]);return h.cloneElement(x(C({},E,{onScroll:this._onScroll})),{ref:function(t){return e.ListViewRef=t},onContentSizeChange:this._onContentSizeChange,onLayout:this._onLayout},this.props.renderHeader?this.props.renderHeader():null,h.cloneElement(E.renderBodyComponent(),{},r),this.props.renderFooter?this.props.renderFooter():null,E.children)}}]),t}(h.Component);Ee.DataSource=me,Ee.propTypes=C({},Se.propTypes,{dataSource:w.instanceOf(me).isRequired,renderSeparator:w.func,renderRow:w.func.isRequired,initialListSize:w.number,onEndReached:w.func,onEndReachedThreshold:w.number,pageSize:w.number,renderFooter:w.func,renderHeader:w.func,renderSectionHeader:w.func,renderScrollComponent:w.func,scrollRenderAheadDistance:w.number,onChangeVisibleRows:w.func,scrollEventThrottle:w.number,renderBodyComponent:w.func,renderSectionWrapper:w.func,renderSectionBodyWrapper:w.func,sectionBodyClassName:w.string,listViewPrefixCls:w.string,useBodyScroll:w.bool}),Ee.defaultProps={initialListSize:10,pageSize:1,renderScrollComponent:function(e){return h.createElement(Se,e)},renderBodyComponent:function(){return h.createElement("div",null)},renderSectionBodyWrapper:function(e){return h.createElement("div",{key:e})},sectionBodyClassName:"list-view-section-body",listViewPrefixCls:"rmc-list-view",scrollRenderAheadDistance:1e3,onEndReachedThreshold:1e3,scrollEventThrottle:50,scrollerOptions:{}};var Ce=function(){var e=this;this.state={curRenderedRowsCount:this.props.initialListSize,highlightedRow:{}},this.getMetrics=function(){return{contentLength:e.scrollProperties.contentLength,totalRows:e.props.dataSource.getRowCount(),renderedRows:e.state.curRenderedRowsCount,visibleRows:Object.keys(e._visibleRows).length}},this.getInnerViewNode=function(){return e.ListViewRef.getInnerViewNode()},this.scrollTo=function(){var t;e.ListViewRef&&e.ListViewRef.scrollTo&&(t=e.ListViewRef).scrollTo.apply(t,arguments)},this.onRowHighlighted=function(t,n){e.setState({highlightedRow:{sectionID:t,rowID:n}})},this._onContentSizeChange=function(t,n){var r=e.props.horizontal?t:n;r!==e.scrollProperties.contentLength&&(e.scrollProperties.contentLength=r,e._renderMoreRowsIfNeeded()),e.props.onContentSizeChange&&e.props.onContentSizeChange(t,n)},this._onLayout=function(t){var n=t.nativeEvent.layout,r=n.width,o=n.height,i=e.props.horizontal?r:o;i!==e.scrollProperties.visibleLength&&(e.scrollProperties.visibleLength=i,e._renderMoreRowsIfNeeded()),e.props.onLayout&&e.props.onLayout(t)},this._maybeCallOnEndReached=function(t){return!!(e.props.onEndReached&&e.scrollProperties.contentLength!==e._sentEndForContentLength&&e._getDistanceFromEnd(e.scrollProperties)<e.props.onEndReachedThreshold&&e.state.curRenderedRowsCount===e.props.dataSource.getRowCount())&&(e._sentEndForContentLength=e.scrollProperties.contentLength,e.props.onEndReached(t),!0)},this._renderMoreRowsIfNeeded=function(){null!==e.scrollProperties.contentLength&&null!==e.scrollProperties.visibleLength&&e.state.curRenderedRowsCount!==e.props.dataSource.getRowCount()?e._getDistanceFromEnd(e.scrollProperties)<e.props.scrollRenderAheadDistance&&e._pageInNewRows():e._maybeCallOnEndReached()},this._pageInNewRows=function(){e.setState((function(t,n){var r=Math.min(t.curRenderedRowsCount+n.pageSize,n.dataSource.getRowCount());return e._prevRenderedRowsCount=t.curRenderedRowsCount,{curRenderedRowsCount:r}}),(function(){e._prevRenderedRowsCount=e.state.curRenderedRowsCount}))},this._getDistanceFromEnd=function(e){return e.contentLength-e.visibleLength-e.offset},this._onScroll=function(t,n){e.ListViewRef&&(e.scrollProperties=n,e._maybeCallOnEndReached(t)||e._renderMoreRowsIfNeeded(),e.props.onEndReached&&e._getDistanceFromEnd(e.scrollProperties)>e.props.onEndReachedThreshold&&(e._sentEndForContentLength=null),e.props.onScroll&&e.props.onScroll(t))}};function be(e){window.document.body.scrollTop=e,window.document.documentElement.scrollTop=e}var Re=function(e){function t(e){S(this,t);var n=E(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return _e.call(n),n.state={pageSize:e.pageSize,_delay:!1},n}return x(t,e),y(t,[{key:"componentDidMount",value:function(){this.dataChange(this.props),this.getQsInfo()}},{key:"componentWillReceiveProps",value:function(e){this.props.dataSource!==e.dataSource&&this.dataChange(e)}},{key:"componentDidUpdate",value:function(){this.getQsInfo()}},{key:"componentWillUnmount",value:function(){this._timer&&clearTimeout(this._timer),this._hCache=null}},{key:"renderQuickSearchBar",value:function(e,t){var n=this,r=this.props,o=r.dataSource,i=r.prefixCls,a=o.sectionIdentities.map((function(e){return{value:e,label:o._getSectionHeaderData(o._dataBlob,e)}}));return h.createElement("ul",{ref:function(e){return n.quickSearchBarRef=e},className:i+"-quick-search-bar",style:t,onTouchStart:this.onTouchStart,onTouchMove:this.onTouchMove,onTouchEnd:this.onTouchEnd,onTouchCancel:this.onTouchEnd},h.createElement("li",{"data-qf-target":e.value,onClick:function(){return n.onQuickSearchTop(void 0,e.value)}},e.label),a.map((function(e){return h.createElement("li",{key:e.value,"data-qf-target":e.value,onClick:function(){return n.onQuickSearch(e.value)}},e.label)})))}},{key:"render",value:function(){var e,t=this,n=this.state,r=n._delay,o=n.pageSize,i=this.props,a=i.className,s=i.prefixCls,l=i.children,c=i.quickSearchBarTop,u=i.quickSearchBarStyle,d=i.initialListSize,p=void 0===d?Math.min(20,this.props.dataSource.getRowCount()):d,f=i.showQuickSearchIndicator,g=i.renderSectionHeader,m=i.sectionHeaderClassName,v=O(i,["className","prefixCls","children","quickSearchBarTop","quickSearchBarStyle","initialListSize","showQuickSearchIndicator","renderSectionHeader","sectionHeaderClassName"]);return h.createElement("div",{className:s+"-container"},r&&this.props.delayActivityIndicator,h.createElement(Ee,C({},v,{ref:function(e){return t.indexedListViewRef=e},className:b(s,a),initialListSize:p,pageSize:o,renderSectionHeader:function(e,n){return h.cloneElement(g(e,n),{ref:function(e){return t.sectionComponents[n]=e},className:m||s+"-section-header"})}}),l),this.renderQuickSearchBar(c,u),f?h.createElement("div",{className:b((e={},R(e,s+"-qsindicator",!0),R(e,s+"-qsindicator-hide",!f||!this.state.showQuickSearchIndicator),e)),ref:function(e){return t.qsIndicatorRef=e}}):null)}}]),t}(h.Component);Re.propTypes=C({},Ee.propTypes,{children:w.any,prefixCls:w.string,className:w.string,sectionHeaderClassName:w.string,quickSearchBarTop:w.object,quickSearchBarStyle:w.object,onQuickSearch:w.func,showQuickSearchIndicator:w.bool}),Re.defaultProps={prefixCls:"rmc-indexed-list",quickSearchBarTop:{value:"#",label:"#"},onQuickSearch:function(){},showQuickSearchIndicator:!1,delayTime:100,delayActivityIndicator:""};var _e=function(){var e=this;this.onQuickSearchTop=function(t,n){e.props.useBodyScroll?be(0):g.findDOMNode(e.indexedListViewRef.ListViewRef).scrollTop=0,e.props.onQuickSearch(t,n)},this.onQuickSearch=function(t){var n=g.findDOMNode(e.indexedListViewRef.ListViewRef),r=g.findDOMNode(e.sectionComponents[t]);e.props.useBodyScroll?be(r.getBoundingClientRect().top-n.getBoundingClientRect().top+function(e){var t=0;do{isNaN(e.offsetTop)||(t+=e.offsetTop)}while(e=e.offsetParent);return t}(n)):n.scrollTop+=r.getBoundingClientRect().top-n.getBoundingClientRect().top,e.props.onQuickSearch(t)},this.onTouchStart=function(t){e._target=t.target,e._basePos=e.quickSearchBarRef.getBoundingClientRect(),document.addEventListener("touchmove",e._disableParent,!1),document.body.className=document.body.className+" "+e.props.prefixCls+"-qsb-moving",e.updateIndicator(e._target)},this.onTouchMove=function(t){if(t.preventDefault(),e._target){var n=function(e){return e.touches&&e.touches.length?e.touches[0]:e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:e}(t),r=e._basePos,o=void 0;if(n.clientY>=r.top&&n.clientY<=r.top+e._qsHeight){var i=void 0;if((o=Math.floor((n.clientY-r.top)/e._avgH))in e._hCache&&(i=e._hCache[o][0]),i){var a=i.getAttribute("data-qf-target");e._target!==i&&(e.props.quickSearchBarTop.value===a?e.onQuickSearchTop(void 0,a):e.onQuickSearch(a),e.updateIndicator(i)),e._target=i}}}},this.onTouchEnd=function(){e._target&&(document.removeEventListener("touchmove",e._disableParent,!1),document.body.className=document.body.className.replace(new RegExp("\\s*"+e.props.prefixCls+"-qsb-moving","g"),""),e.updateIndicator(e._target,!0),e._target=null)},this.getQsInfo=function(){var t=e.quickSearchBarRef,n=t.offsetHeight,r=[];[].slice.call(t.querySelectorAll("[data-qf-target]")).forEach((function(e){r.push([e])}));for(var o=n/r.length,i=0,a=0,s=r.length;a<s;a++)i=a*o,r[a][1]=[i,i+o];e._qsHeight=n,e._avgH=o,e._hCache=r},this.sectionComponents={},this.dataChange=function(t){var n=t.dataSource.getRowCount();n&&(e.setState({_delay:!0}),e._timer&&clearTimeout(e._timer),e._timer=setTimeout((function(){e.setState({pageSize:n,_delay:!1},(function(){return e.indexedListViewRef._pageInNewRows()}))}),t.delayTime))},this.updateIndicator=function(t,n){var r=t;r.getAttribute("data-qf-target")||(r=r.parentNode),e.props.showQuickSearchIndicator&&(e.qsIndicatorRef.innerText=r.innerText.trim(),e.setState({showQuickSearchIndicator:!0}),e._indicatorTimer&&clearTimeout(e._indicatorTimer),e._indicatorTimer=setTimeout((function(){e.setState({showQuickSearchIndicator:!1})}),1e3));var o=e.props.prefixCls+"-quick-search-bar-over";e._hCache.forEach((function(e){e[0].className=e[0].className.replace(o,"")})),n||(r.className=r.className+" "+o)},this._disableParent=function(e){e.preventDefault(),e.stopPropagation()}};Ee.IndexedList=Re;var ke=M.Item;function Te(e,t){var n=e.renderHeader,r=e.renderFooter,o=e.renderSectionHeader,i=e.renderBodyComponent,a=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&(n[r[o]]=e[r[o]])}return n}(e,["renderHeader","renderFooter","renderSectionHeader","renderBodyComponent"]),s=e.listPrefixCls,l={renderHeader:null,renderFooter:null,renderSectionHeader:null,renderBodyComponent:i||function(){return p.exports.createElement("div",{className:s+"-body"})}};return n&&(l.renderHeader=function(){return p.exports.createElement("div",{className:s+"-header"},n())}),r&&(l.renderFooter=function(){return p.exports.createElement("div",{className:s+"-footer"},r())}),o&&(l.renderSectionHeader=t?function(e,t){return p.exports.createElement("div",null,p.exports.createElement(ke,{prefixCls:s},o(e,t)))}:function(e,t){return p.exports.createElement(ke,{prefixCls:s},o(e,t))}),{restProps:a,extraProps:l}}var Le=Ee.IndexedList,Ne=function(e){function t(){return S(this,t),E(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return x(t,e),y(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.prefixCls,r=t.listPrefixCls,o=Te(this.props,!0),i=o.restProps,a=o.extraProps;return p.exports.createElement(Le,C({ref:function(t){return e.indexedListRef=t},sectionHeaderClassName:n+"-section-header "+r+"-body",sectionBodyClassName:n+"-section-body "+r+"-body"},i,a),this.props.children)}}]),t}(p.exports.Component);Ne.defaultProps={prefixCls:"am-indexed-list",listPrefixCls:"am-list",listViewPrefixCls:"am-list-view"};var Ie=function(e){function t(){S(this,t);var e=E(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.scrollTo=function(){var t;return(t=e.listviewRef).scrollTo.apply(t,arguments)},e.getInnerViewNode=function(){return e.listviewRef.getInnerViewNode()},e}return x(t,e),y(t,[{key:"render",value:function(){var e=this,t=Te(this.props,!1),n=t.restProps,r=t.extraProps;return p.exports.createElement(Ee,C({ref:function(t){return e.listviewRef=t}},n,r))}}]),t}(p.exports.Component);Ie.defaultProps={prefixCls:"am-list-view",listPrefixCls:"am-list"},Ie.DataSource=Ee.DataSource,Ie.IndexedList=Ne;var He=_(Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:{activateText:"松开立即刷新",deactivateText:"下拉可以刷新",finishText:"完成刷新"}})),Pe=function(e){function t(){return S(this,t),E(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return x(t,e),y(t,[{key:"shouldComponentUpdate",value:function(e){return e.shouldUpdate}},{key:"render",value:function(){return h.createElement("div",null,this.props.render())}}]),t}(h.Component);function ze(e,t){e.transform=t,e.webkitTransform=t,e.MozTransform=t}var Be="undefined"!=typeof navigator&&/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent),De="down",Oe="up",Me={activate:"release",deactivate:"pull",release:"loading",finish:"finish"},je=!1;try{var Ve=Object.defineProperty({},"passive",{get:function(){je=!0}});window.addEventListener("test",null,Ve)}catch(ut){}var qe=!!je&&{passive:!1},We=function(e){function t(){S(this,t);var e=E(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.state={currSt:"deactivate",dragOnEdge:!1},e._isMounted=!1,e.shouldUpdateChildren=!1,e.triggerPullToRefresh=function(){!e.state.dragOnEdge&&e._isMounted&&(e.props.refreshing?(e.props.direction===Oe&&(e._lastScreenY=-e.props.distanceToRefresh-1),e.props.direction===De&&(e._lastScreenY=e.props.distanceToRefresh+1),e.setState({currSt:"release"},(function(){return e.setContentStyle(e._lastScreenY)}))):e.setState({currSt:"finish"},(function(){return e.reset()})))},e.init=function(t){t&&(e._to={touchstart:e.onTouchStart.bind(e,t),touchmove:e.onTouchMove.bind(e,t),touchend:e.onTouchEnd.bind(e,t),touchcancel:e.onTouchEnd.bind(e,t)},Object.keys(e._to).forEach((function(n){t.addEventListener(n,e._to[n],qe)})))},e.destroy=function(t){e._to&&t&&Object.keys(e._to).forEach((function(n){t.removeEventListener(n,e._to[n])}))},e.onTouchStart=function(t,n){e._ScreenY=e._startScreenY=n.touches[0].screenY,e._startScreenX=n.touches[0].screenX,e._lastScreenY=e._lastScreenY||0},e.isEdge=function(t,n){var r=e.props.getScrollContainer();if(r&&r===document.body){var o=document.scrollingElement?document.scrollingElement:document.body;if(n===Oe)return o.scrollHeight-o.scrollTop<=window.innerHeight;if(n===De)return o.scrollTop<=0}return n===Oe?t.scrollHeight-t.scrollTop===t.clientHeight:n===De?t.scrollTop<=0:void 0},e.damping=function(t){return Math.abs(e._lastScreenY)>e.props.damping?0:t*=(1-Math.abs(e._ScreenY-e._startScreenY)/window.screen.height)*e.props.scale},e.onTouchMove=function(t,n){var r=n.touches[0].screenY,o=n.touches[0].screenX,i=e.props.direction;if(!(Math.abs(o-e._startScreenX)>20*window.devicePixelRatio)&&!(i===Oe&&e._startScreenY<r||i===De&&e._startScreenY>r)&&e.isEdge(t,i)){e.state.dragOnEdge||(e._ScreenY=e._startScreenY=n.touches[0].screenY,e.setState({dragOnEdge:!0})),n.preventDefault();var a=Math.round(r-e._ScreenY);e._ScreenY=r,e._lastScreenY+=e.damping(a),e.setContentStyle(e._lastScreenY),Math.abs(e._lastScreenY)<e.props.distanceToRefresh?"deactivate"!==e.state.currSt&&e.setState({currSt:"deactivate"}):"deactivate"===e.state.currSt&&e.setState({currSt:"activate"}),Be&&n.changedTouches[0].clientY<0&&e.onTouchEnd()}},e.onTouchEnd=function(){e.state.dragOnEdge&&e.setState({dragOnEdge:!1}),"activate"===e.state.currSt?(e.setState({currSt:"release"}),e._timer=setTimeout((function(){e.props.refreshing||e.setState({currSt:"finish"},(function(){return e.reset()})),e._timer=void 0}),1e3),e.props.onRefresh()):e.reset()},e.reset=function(){e._lastScreenY=0,e.setContentStyle(0)},e.setContentStyle=function(t){e.contentRef&&ze(e.contentRef.style,"translate3d(0px,"+t+"px,0)")},e}return x(t,e),y(t,[{key:"shouldComponentUpdate",value:function(e){return this.shouldUpdateChildren=this.props.children!==e.children,!0}},{key:"componentDidUpdate",value:function(e){e!==this.props&&e.refreshing!==this.props.refreshing&&this.triggerPullToRefresh()}},{key:"componentDidMount",value:function(){var e=this;setTimeout((function(){e.init(e.props.getScrollContainer()||e.containerRef),e.triggerPullToRefresh(),e._isMounted=!0}))}},{key:"componentWillUnmount",value:function(){this.destroy(this.props.getScrollContainer()||this.containerRef)}},{key:"render",value:function(){var e=this,t=C({},this.props);delete t.damping;var n=t.className,r=t.prefixCls,o=t.children,i=t.getScrollContainer,a=t.direction;t.onRefresh,t.refreshing;var s=t.indicator;t.distanceToRefresh;var l=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&(n[r[o]]=e[r[o]])}return n}(t,["className","prefixCls","children","getScrollContainer","direction","onRefresh","refreshing","indicator","distanceToRefresh"]),c=h.createElement(Pe,{shouldUpdate:this.shouldUpdateChildren,render:function(){return o}}),u=function(t){var n=b(t,!e.state.dragOnEdge&&r+"-transition");return h.createElement("div",{className:r+"-content-wrapper"},h.createElement("div",{className:n,ref:function(t){return e.contentRef=t}},a===Oe?c:null,h.createElement("div",{className:r+"-indicator"},s[e.state.currSt]||Me[e.state.currSt]),a===De?c:null))};return i()?u(r+"-content "+r+"-"+a):h.createElement("div",C({ref:function(t){return e.containerRef=t},className:b(n,r,r+"-"+a)},l),u(r+"-content"))}}]),t}(h.Component);We.defaultProps={prefixCls:"rmc-pull-to-refresh",getScrollContainer:function(){},direction:De,distanceToRefresh:25,damping:100,indicator:Me,scale:.6};var Fe=function(e){function t(){return S(this,t),E(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return x(t,e),y(t,[{key:"render",value:function(){var e=j(this.props,this.context,"PullToRefresh",(function(){return He})),t=e.activateText,n=e.deactivateText,r=e.finishText,o=C({activate:t,deactivate:n,release:p.exports.createElement(k,{type:"loading"}),finish:r},this.props.indicator);return p.exports.createElement(We,C({},this.props,{indicator:o}))}}]),t}(p.exports.Component);function Ye(e){return h.createElement(Fe,s({},e))}Fe.defaultProps={prefixCls:"am-pull-to-refresh"},Fe.contextTypes={antLocale:T.exports.object};class Ae extends p.exports.Component{constructor(){super(...arguments),c(this,"state",{dataSource:new Ie.DataSource({rowHasChanged:(e,t)=>e!==t}),refreshing:!0,isLoading:!0,pagination:this.props.defaultPagination||{pageNum:0,pageSize:20,total:0},height:0}),c(this,"rData",[]),c(this,"calcRef",p.exports.createRef()),c(this,"onResize",(()=>{const e=this.calcRef.current.getBoundingClientRect().top,t=window.innerHeight;this.setState({height:t-e-(this.props.offset?50:0)})})),c(this,"getData",((...e)=>u(this,[...e],(function*(e=this.state.pagination.pageNum+1,t=this.state.pagination.pageSize){const{getDataMethod:n}=this.props,{list:r,total:o}=yield n({pageNum:e,pageSize:t});if(0===e)return this.rData=[...r],void this.setState({dataSource:new Ie.DataSource({rowHasChanged:(e,t)=>e!==t}).cloneWithRows(r),refreshing:!1,isLoading:!1,pagination:{total:o,pageNum:e,pageSize:t}});r.length>0?(this.rData=[...this.rData,...r],this.setState({dataSource:this.state.dataSource.cloneWithRows(this.rData),refreshing:!1,isLoading:!1,pagination:{total:o,pageNum:e,pageSize:t}})):this.setState({refreshing:!1,isLoading:!1})})))),c(this,"onRefresh",(()=>{this.setState({refreshing:!0,isLoading:!0}),this.getData(0)})),c(this,"onEndReached",(()=>{this.state.isLoading||this.rData.length>=this.state.pagination.total||(this.setState({isLoading:!0}),this.getData())}))}componentDidMount(){this.props.apiRef&&(this.props.apiRef.current={getData:this.getData}),this.getData(0),this.onResize(),window.addEventListener("resize",this.onResize)}componentWillUnmount(){window.removeEventListener("resize",this.onResize)}render(){const{dataSource:e,pagination:t,refreshing:n,isLoading:r}=this.state,{renderRow:o,contentContainerStyle:i={},renderSeparator:a=((e,t)=>h.createElement("div",{key:`${e}-${t}`,className:"list-gap"}))}=this.props;return h.createElement("div",{ref:this.calcRef,className:"pull-list"},h.createElement(Ie,{dataSource:e,contentContainerStyle:i,renderFooter:()=>h.createElement("div",{className:"pull-list-footer"},r?"加载中...":"已经没有更多数据了"),renderRow:o,renderSeparator:a,useBodyScroll:!1,style:{height:this.state.height+"px"},pullToRefresh:h.createElement(Ye,{refreshing:n,onRefresh:this.onRefresh}),onEndReached:this.onEndReached,pageSize:t.pageSize}))}}const Ue=W((e=>({contentContainerStyle:{boxSizing:"border-box"},root:{backgroundColor:e.bg.pri,padding:"16px",borderBottom:"1px solid rgba(57, 60, 67, 0.08)"},userImg:{display:"inline-block",marginRight:"14px"},actionBar:{marginTop:"16px"},icon1:{fontSize:"14px",color:e.fc.desc,marginRight:"40px"},guanzhu:{color:e.fc.header}})));function Qe({query:e,offset:t}){const n=Ue(),r=p.exports.useRef(null),o=v();p.exports.useEffect((()=>{r.current.getData(0)}),[e]);const i=p.exports.useCallback((t=>u(this,null,(function*(){return yield function(e){return u(this,arguments,(function*({tag:e,author:t,favorited:n,pageSize:r=20,pageNum:o=0}){try{const i=yield N.get("/articles",{params:{tag:e,author:t,favorited:n,limit:r,offset:o},loading:!0});return{list:i.data.articles,total:i.data.articlesCount}}catch(ut){return{list:[],total:0}}}))}(s(s({},t),e))}))),[e]),a=p.exports.useCallback((e=>{if(!e.slug)return I.info("没有slug");localStorage.removeItem("gotoComment"),o.push(`/posts/${e.slug}`)}),[]),l=p.exports.useMemo((()=>(e,t,r)=>{var i,l;return h.createElement("div",{className:"article-row-item",style:n.root,onClick:()=>a(e)},h.createElement("div",{className:"f-r j-between a-center"},h.createElement("div",{className:"f-r a-center",onClick:t=>{var n;t.stopPropagation(),o.push(`/profile/${null==(n=null==e?void 0:e.author)?void 0:n.username}`)}},h.createElement(ne,{className:"user-img",src:null==(i=null==e?void 0:e.author)?void 0:i.image,style:n.userImg}),h.createElement("div",null,h.createElement("div",{className:"header"},(null==(l=null==e?void 0:e.author)?void 0:l.username)||"示例昵称"),h.createElement("div",{className:"secd"},e.updateAt||"1小时前")))),h.createElement("div",{className:"title"},e.title||"我是一个标题"),h.createElement("div",{className:"content hidecontent"},e.description||$e),h.createElement("div",{className:"f-r j-end",style:n.actionBar},h.createElement("div",{className:"f-r j-center a-center",onClick:t=>{t.stopPropagation(),a(e),localStorage.setItem("gotoComment","1")}},h.createElement(Q,{style:n.icon1})),h.createElement(K,s({},e))))}),[n]),c=p.exports.useMemo((()=>(e,t)=>h.createElement("div",{key:`${e}-${t}`,className:"article-list-gap"})),[]);return h.createElement("div",null,h.createElement(Ae,{apiRef:r,offset:t,getDataMethod:i,renderRow:l,renderSeparator:c,contentContainerStyle:n.contentContainerStyle}))}const $e="你知道吗，每刷新1次，你的页面就变成了新的，刷新2次，就会变2次",Xe=W((e=>({tabBarTextStyle:{padding:0,height:"36px",lineHeight:"36px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",display:"block",textAlign:"center",fontSize:"14px"},writeBtn:{position:"fixed",bottom:"64px",right:"8px",height:"48px",width:"48px",fontSize:"24px",borderRadius:"24px",color:"#fff",backgroundImage:" linear-gradient(0deg, rgb(255,91,91),rgb(255,131,101))",transform:"rotateZ(-45deg)"}})));function Ke(){const e=Xe(),[t,n]=p.exports.useState([]),[r,o]=p.exports.useState({}),i=v();p.exports.useEffect((()=>{!function(){u(this,null,(function*(){n(yield function(){return u(this,null,(function*(){try{return(yield N.get("/tags")).data.tags}catch(ut){return[]}}))}())}))}()}),[]);const a=p.exports.useCallback((({title:e})=>{const t="全部"===e?null:e;o(l(s({},r),{tag:t}))}),[r]);return h.createElement("div",{className:"rvt-tabview"},h.createElement("div",{className:"am-navbar"},h.createElement(Ge,{tags:t,onTabChange:a})),h.createElement("div",{style:{paddingTop:"36px",boxSizing:"border-box"}},h.createElement(Qe,{query:r,offset:!0})),h.createElement(H,{className:"f-r j-center a-center",style:e.writeBtn,onClick:()=>i.push("/edit")},h.createElement(ce,null)))}function Ge({tags:e,onTabChange:t}){const n=Xe(),r=p.exports.useMemo((()=>[{title:"全部"},...e.map((e=>({title:e})))]),[e]);return h.createElement(L,{tabs:r,tabBarTextStyle:n.tabBarTextStyle,initialPage:0,onChange:t})}var Je=d(p.exports.createElement("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"}));const Ze=W((e=>({root:{paddingTop:"36px"},tabBarTextStyle:{padding:0,height:"36px",lineHeight:"36px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",display:"block",textAlign:"center",fontSize:"14px"}})));function et(e){const t=Ze();return h.createElement("div",{style:t.root},h.createElement(D,{title:"我的文章"}),h.createElement(tt,{username:F.getState().app.uinfo.username,type:e.match.params.type}))}function tt({username:e,type:t="0"}){const n=Ze(),[r,o]=p.exports.useState("0"===t?{author:e}:{favorited:e}),i=p.exports.useCallback((({title:t})=>{"我的文章"===t?o({author:e}):"我喜欢的文章"===t&&o({favorited:e})}),[]);return h.createElement("div",null,h.createElement(L,{tabs:[{title:"我的文章"},{title:"我喜欢的文章"}],tabBarTextStyle:n.tabBarTextStyle,initialPage:Number(t),onChange:i}),h.createElement(Qe,{query:r,offset:!0}))}const nt=W((e=>({btn:{fontSize:"12px",color:"#56ba68",height:"24px",lineHeight:"24px",padding:"0 8px",borderRadius:"12px",border:"1px solid #56ba68",transition:"0.3s"},activeBtn:{fontSize:"12px",color:"#fff",height:"24px",lineHeight:"24px",padding:"0 8px",borderRadius:"12px",backgroundColor:" #56ba68",border:"1px solid #56ba68",transition:"0.3s"}})));function rt({following:e,username:t}){const n=nt(),[r,o]=p.exports.useState(e);return console.log(r,e),p.exports.useEffect((()=>{o(e)}),[e]),h.createElement("div",null,r?h.createElement("div",{style:n.activeBtn,onClick:function(){return u(this,null,(function*(){"following"in(yield function(e){return u(this,arguments,(function*({username:e}){try{return(yield N.delete(`/profiles/${e}/follow`,{loading:!0})).data.profile}catch(ut){return{}}}))}({username:t}))?(o(!1),I.info("取消关注成功")):I.info("取消关注失败")}))}},"已关注"):h.createElement("div",{style:n.btn,onClick:function(){return u(this,null,(function*(){"following"in(yield function(e){return u(this,arguments,(function*({username:e}){try{return(yield N.post(`/profiles/${e}/follow`,{},{loading:!0})).data.profile}catch(ut){return{}}}))}({username:t}))?(o(!0),I.info("关注成功")):I.info("关注失败")}))}},"关注"))}const ot=W((e=>({header:{position:"relative",height:"20vh",backgroundImage:"url(/realword-front.github.io/assets/maoboli.2da01a31.jpeg)",backgroundSize:"cover"},backBtn:{position:"absolute",fontSize:"18px",top:"16px",left:"16px",color:"#fff"},viteImg:{height:"50%",objectFit:"contain"},profileDiv:{padding:"16px",backgroundColor:e.bg.pri,position:"relative"},avatar:{boxSizing:"border-box",border:`3px solid ${e.bg.pri}`,position:"absolute",top:"-32px",left:"16px"},editBtn:{fontSize:"12px",color:"#56ba68",height:"24px",lineHeight:"24px",padding:"0 8px",borderRadius:"12px",border:"1px solid #56ba68",transition:"0.3s"},username:{fontSize:"18px",color:e.fc.header,marginBottom:"6px"},bio:{fontSize:"14px",color:e.fc.text}})));var it=m((e=>({uinfo:e.app.uinfo})))((function(e){const t=ot(),n=v(),[r,o]=p.exports.useState({});p.exports.useEffect((()=>{i()}),[]);const i=p.exports.useCallback((()=>u(this,null,(function*(){o(yield function(e){return u(this,arguments,(function*({username:e}){try{return(yield N.get(`/profiles/${e}`)).data.profile}catch(ut){return{}}}))}({username:e.match.params.username}))}))),[]);return h.createElement("div",null,h.createElement("div",{style:t.header,className:"f-r j-center a-center"},h.createElement(Je,{style:t.backBtn,onClick:n.goBack}),h.createElement("img",{style:t.viteImg,src:"/realword-front.github.io/assets/favicon.17e50649.svg"})),h.createElement("div",{style:t.profileDiv},h.createElement(ne,{className:"user-img lg",style:t.avatar,src:r.image}),h.createElement("div",{className:"f-r j-end"},r.username===e.uinfo.username?h.createElement("div",{style:t.editBtn,onClick:()=>n.push(`/account/${e.uinfo.username}`)},"编辑资料"):h.createElement(rt,{following:r.following,username:r.username})),h.createElement("div",null,h.createElement("div",{style:t.username},r.username||"..."),h.createElement("div",{style:t.bio},r.bio||"暂无简介"))),h.createElement(tt,{username:e.match.params.username}))})),at=d(p.exports.createElement("path",{d:"M21.41 11.58l-9-9C12.05 2.22 11.55 2 11 2H4c-1.1 0-2 .9-2 2v7c0 .55.22 1.05.59 1.42l9 9c.36.36.86.58 1.41.58.55 0 1.05-.22 1.41-.59l7-7c.37-.36.59-.86.59-1.41 0-.55-.23-1.06-.59-1.42zM5.5 7C4.67 7 4 6.33 4 5.5S4.67 4 5.5 4 7 4.67 7 5.5 6.33 7 5.5 7zm11.77 8.27L13 19.54l-4.27-4.27C8.28 14.81 8 14.19 8 13.5c0-1.38 1.12-2.5 2.5-2.5.69 0 1.32.28 1.77.74l.73.72.73-.73c.45-.45 1.08-.73 1.77-.73 1.38 0 2.5 1.12 2.5 2.5 0 .69-.28 1.32-.73 1.77z"}));const st=W((e=>({root:{height:window.innerHeight+"px",boxSizing:"border-box",paddingTop:"36px"},list:{height:"100%"},input:{fontSize:"16px",fontWeight:400},tagInput:{fontSize:"12px",fontWeight:400},body:{flex:1},leftContenr:{fontSize:"14px",color:e.fc.desc},rightBtn:{fontSize:"14px",color:e.fc.active},tagList:{overflowX:"scroll"}})));var lt=V()((function({form:e,match:t}){var n;const r=st(),{getFieldProps:o,getFieldValue:i}=e,a=v(),c=p.exports.useMemo((()=>t.params.slug),[t.params.slug]);return p.exports.useEffect((()=>{c&&function(){u(this,null,(function*(){const t=yield A({slug:c});e.setFieldsValue(t)}))}()}),[]),h.createElement("div",{style:r.root},h.createElement(D,{leftContent:h.createElement("div",{style:r.leftContenr},(null==(n=i("body"))?void 0:n.length)||0,"字"),rightContent:h.createElement("div",{style:r.rightBtn,onClick:function(){return u(this,null,(function*(){try{const t=yield e.validateFields();let n="";n=yield Y(t),n?I.info("提交成功,快去看你的文章吧",3,(function(){a.push(`/posts/${n}`)})):I.info("提交失败")}catch(ut){if(ut.errors){const t=Object.values(ut.errors).map((e=>e.errors.map((e=>e.message)))).join("");I.fail(t)}}}))}},"发布")}),h.createElement(M,{className:"fcList",style:r.list},h.createElement(q,l(s({style:r.input},o("title",{rules:[{required:!0,message:"标题不能为空!"},{max:20,message:"标题不能大于20字!"}]})),{placeholder:"请输入标题"})),h.createElement(ct,l(s({style:r.tagInput},o("tagList",{rules:[{required:!0,message:"邮箱不能为空!"}]})),{placeholder:"请输入标签"})),h.createElement(P,l(s({},o("description")),{rows:2,placeholder:"请输入简介"})),h.createElement(P,l(s({className:"f1",autoHeight:!0},o("body",{rules:[{required:!0,message:"正文不能为空!"}]})),{placeholder:"请输入正文"}))))}));function ct({value:e=[],onChange:t}){const n=st(),[r,o]=p.exports.useState("");return h.createElement("div",null,h.createElement(q,{value:r,onChange:o,style:n.tagInput,extra:h.createElement(at,{style:{fontSize:"16px"},onClick:function(){return r?e.length>2?I.info("标签不能大于3个!"):r.length>10?I.info("标签内容不能大于10字!"):(t([...e,r]),void o("")):I.info("标签内容不能为空!")}}),placeholder:"请输入标签"}),h.createElement(M.Item,null,h.createElement("div",{style:n.tagList},e.map(((n,r)=>h.createElement("div",{onClick:()=>function(n){B.alert("提示","确定要删除标签?",[{text:"算了",onPress:()=>console.log("cancel"),style:"default"},{text:"确定",onPress:()=>{e.splice(n,1),t(e)}}])}(r),className:"tag"},n))))))}export{lt as Edit,et as MyArticles,le as Posts,it as Profile,Ke as default};
