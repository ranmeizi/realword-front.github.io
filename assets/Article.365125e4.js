var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,a=(t,n,r)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r,s=(e,t)=>{for(var n in t||(t={}))o.call(t,n)&&a(e,n,t[n]);if(r)for(var n of r(t))i.call(t,n)&&a(e,n,t[n]);return e},l=("undefined"!=typeof require&&require,(e,t,n)=>(a(e,"symbol"!=typeof t?t+"":t,n),n)),c=(e,t,n)=>new Promise(((r,o)=>{var i=e=>{try{s(n.next(e))}catch(t){o(t)}},a=e=>{try{s(n.throw(e))}catch(t){o(t)}},s=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,a);s((n=n.apply(e,t)).next())}));import{o as u,c as d,q as h,s as p,x as f,y as m,z as g,D as v,E as y,R as S,r as w,a as b,F as x,u as C,G as E,H as R,I as _,J as k,K as T}from"./vendor.eb8a5d52.js";import{i as N,I as L,T as H,_ as P,C as I,d as O,M as z,R as B,a as D,L as M,g as j}from"./getLocale.c190ad38.js";import{m as V,s as F}from"./index.645384cd.js";var q=u(d.exports.createElement("path",{d:"M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"})),W=u(d.exports.createElement("path",{d:"M21.99 4c0-1.1-.89-2-1.99-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h14l4 4-.01-18zM18 14H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"}));function Y(){}var A=/[\uD800-\uDBFF][\uDC00-\uDFFF]|\n/g;var U=function(e){function t(e){p(this,t);var n=f(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.focus=function(){n.textareaRef.focus()},n.reAlignHeight=function(){var e=n.textareaRef;e.style.height="",e.style.height=e.scrollHeight+"px"},n.onChange=function(e){var t=e.target.value;"value"in n.props?n.setState({value:n.props.value}):n.setState({value:t});var r=n.props.onChange;r&&r(t),n.componentDidUpdate()},n.onBlur=function(e){n.debounceTimeout=setTimeout((function(){document.activeElement!==n.textareaRef&&n.setState({focus:!1})}),100);var t=e.currentTarget.value;n.props.onBlur&&(setTimeout((function(){document.body&&(document.body.scrollTop=document.body.scrollTop)}),100),n.props.onBlur(t))},n.onFocus=function(e){n.debounceTimeout&&(clearTimeout(n.debounceTimeout),n.debounceTimeout=null),n.setState({focus:!0});var t=e.currentTarget.value;n.props.onFocus&&n.props.onFocus(t)},n.onErrorClick=function(){n.props.onErrorClick&&n.props.onErrorClick()},n.clearInput=function(){n.setState({value:""}),n.props.onChange&&n.props.onChange("")},n.state={focus:!1,value:e.value||e.defaultValue||""},n}return h(t,e),m(t,[{key:"componentWillReceiveProps",value:function(e){var t;"value"in e&&this.setState({value:(t=e.value,null==t?"":t)})}},{key:"componentDidMount",value:function(){this.props.autoHeight&&this.reAlignHeight()}},{key:"componentDidUpdate",value:function(){this.props.autoHeight&&this.reAlignHeight()}},{key:"componentWillUnmount",value:function(){this.debounceTimeout&&(clearTimeout(this.debounceTimeout),this.debounceTimeout=null)}},{key:"render",value:function(){var e,t,n=this,r=this.props,o=r.prefixCls,i=r.prefixListCls,a=r.editable,s=r.style,l=r.clear;r.children;var c=r.error,u=r.className,h=r.count,p=r.labelNumber,f=r.title;r.onErrorClick;var m=r.autoHeight;r.defaultValue;var S=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&(n[r[o]]=e[r[o]])}return n}(r,["prefixCls","prefixListCls","editable","style","clear","children","error","className","count","labelNumber","title","onErrorClick","autoHeight","defaultValue"]),w=S.disabled,b=this.state,x=b.value,C=b.focus,E=h>0&&this.props.rows>1,R=g(u,i+"-item",o+"-item",(v(e={},o+"-disabled",w),v(e,o+"-item-single-line",1===this.props.rows&&!m),v(e,o+"-error",c),v(e,o+"-focus",C),v(e,o+"-has-count",E),e)),_=g(o+"-label",(v(t={},o+"-label-2",2===p),v(t,o+"-label-3",3===p),v(t,o+"-label-4",4===p),v(t,o+"-label-5",5===p),v(t,o+"-label-6",6===p),v(t,o+"-label-7",7===p),t)),k=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").replace(A,"_").length}(x),T={};if(h>0)if(L){var N=x?x.replace(A,"_"):"",P=N?N.split("_").length-1:0;T.maxLength=h+P-k+(x?x.length:0)}else T.maxLength=h-k+(x?x.length:0);return d.exports.createElement("div",{className:R},f&&d.exports.createElement("div",{className:_},f),d.exports.createElement("div",{className:o+"-control"},d.exports.createElement("textarea",y({ref:function(e){return n.textareaRef=e}},T,S,{value:x,onChange:this.onChange,onBlur:this.onBlur,onFocus:this.onFocus,readOnly:!a,style:s}))),l&&a&&x&&k>0&&d.exports.createElement(H,{activeClassName:o+"-clear-active"},d.exports.createElement("div",{className:o+"-clear",onClick:this.clearInput})),c&&d.exports.createElement("div",{className:o+"-error-extra",onClick:this.onErrorClick}),E&&d.exports.createElement("span",{className:o+"-count"},d.exports.createElement("span",null,x?k:0),"/",h))}}]),t}(d.exports.Component);U.defaultProps={prefixCls:"am-textarea",prefixListCls:"am-list",autoHeight:!1,editable:!0,disabled:!1,placeholder:"",clear:!1,rows:1,onChange:Y,onBlur:Y,onFocus:Y,onErrorClick:Y,error:!1,labelNumber:5};var Q=u(d.exports.createElement("path",{d:"M2 20h2c.55 0 1-.45 1-1v-9c0-.55-.45-1-1-1H2v11zm19.83-7.12c.11-.25.17-.52.17-.8V11c0-1.1-.9-2-2-2h-5.5l.92-4.65c.05-.22.02-.46-.08-.66-.23-.45-.52-.86-.88-1.22L14 2 7.59 8.41C7.21 8.79 7 9.3 7 9.83v7.84C7 18.95 8.05 20 9.34 20h8.11c.7 0 1.36-.37 1.72-.97l2.66-6.15z"}));const $=V((e=>({favouriteStyle:{fontSize:"14px",color:e.fc.active},unFavouriteStyle:{fontSize:"14px",color:e.fc.desc}})));function X({favoritesCount:e=0,favorited:t=!1,slug:n=""}){const r=$(),[o,i]=d.exports.useState(e),[a,s]=d.exports.useState(t),l=d.exports.useCallback((e=>c(this,null,(function*(){e.stopPropagation(),a?(yield function(t){return c(this,arguments,(function*({slug:t}){try{if(200!==(yield N.delete(`/articles/${t}/favorite`,{loading:!0})).status)throw new Error("点赞失败");return 1}catch(e){return-1}}))}({slug:n}))>0&&(i(o-1),s(!1)):(yield function(t){return c(this,arguments,(function*({slug:t}){try{if(200!==(yield N.post(`/articles/${t}/favorite`,{},{loading:!0})).status)throw new Error("点赞失败");return 1}catch(e){return-1}}))}({slug:n}))>0?(P.info("点赞成功"),i(o+1),s(!0)):P.info("点赞失败")}))),[a]);return S.createElement(I,{className:"f-r a-center",onClick:l,style:a?r.favouriteStyle:r.unFavouriteStyle},S.createElement(Q,{style:{fontSize:"14px",marginRight:"4px"}})," ",e)}const K=V((e=>({icon1:{fontSize:"14px",marginRight:"4px"},action:{flex:1,boxSizing:"border-box",paddingLeft:"16px"},publishBtn:{backgroundColor:e.fc.active,height:"24px",lineHeight:"24px",padding:"0 16px",borderRadius:"12px",color:"#fff",fontSize:"12px"},mask:{height:window.innerHeight+"px",width:"100vw",position:"fixed",top:0,bottom:0,backgroundColor:"rgba(0,0,0,0.15)"},commentBar:{position:"absolute",boxSizing:"border-box",bottom:0,left:0,width:"100vw",padding:"8px 12px",backgroundColor:e.bg.pri}})));function G({data:e,updateComments:t,commentCount:n}){const[r,o]=d.exports.useState(!1),i=K();return S.createElement("div",{className:"f-r a-center article-underbar"},S.createElement(I,{className:"fake-input",onClick:()=>o(!0)},"说点什么吧"),S.createElement("div",{className:"f-r j-around a-center",style:i.action},S.createElement("div",{className:"f-r"},S.createElement(W,{style:i.icon1}),n),S.createElement(X,s({},e)),S.createElement("div",null,S.createElement(q,{style:i.icon1,onClick:J})),r?S.createElement(Z,s({updateComments:t,onMaskClose:()=>o(!1)},e)):null))}function J(){P.info("得要微信号分享,我再想想咋整")}function Z({onMaskClose:e,slug:t,updateComments:n}){const r=K(),[o,i]=d.exports.useState("");return w.exports.useUnactivate((()=>{e()})),b.createPortal(S.createElement("div",{style:r.mask,onClick:e},S.createElement("div",{style:r.commentBar,onClick:e=>e.stopPropagation()},S.createElement(U,{value:o,onChange:i,rows:3}),S.createElement("div",{className:"f-r j-end",style:{marginTop:"8px"}},S.createElement("div",{style:r.publishBtn,onClick:function(){return c(this,null,(function*(){if(!o)return;(yield function(e){return c(this,arguments,(function*({slug:e,body:t}){try{if(200!==(yield N.post(`/articles/${e}/comments`,{comment:{body:t}})).status)throw new Error("失败");return 1}catch(n){return-1}}))}({slug:t,body:o}))>0?(P.success("发表成功"),n(),e()):P.fail("发表失败")}))}},"发表")))),document.body)}let ee=0;function te(e){var t=e,{src:n}=t,a=((e,t)=>{var n={};for(var a in e)o.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&r)for(var a of r(e))t.indexOf(a)<0&&i.call(e,a)&&(n[a]=e[a]);return n})(t,["src"]);const[l,c]=d.exports.useState(!1),u=d.exports.useRef(null),h=d.exports.useRef(-1),p=d.exports.useCallback((()=>{var e,t;h.current===(null==(t=null==(e=u.current)?void 0:e.dataset)?void 0:t.errtoken)&&c(!1)}),[h.current]);return d.exports.useEffect((()=>{const e=ee++;u.current&&(u.current.dataset.errtoken=e),h.current=e,c(!0)}),[n]),S.createElement("img",s({ref:u,src:l?O:n,onError:p},a))}const ne=V((e=>({root:{marginTop:"16px"},jiange:{height:"8px",width:"100vw",margin:"0 -16px",backgroundColor:e.bg.sec},divider:{width:"100vw",margin:"0 -16px"},header:{height:"36px",lineHeight:"36px",backgroundColor:"rgba(0,0,0,0.07)",width:window.innerWidth-32+"px",margin:"0 -16px",padding:"0 16px",fontWeight:600,color:e.fc.header},rowItem:{padding:"16px 0",position:"relative"},avatar:{marginRight:"8px"},uname:{color:e.fc.header,fontSize:"14px",fontWeight:800},body:{fontSize:"12px",marginTop:"8px",color:e.fc.text},empty:{padding:"16px 0",color:e.fc.text},delBtn:{color:e.fc.active,position:"absolute",right:"8px",top:"16px"}})));var re=x((e=>({uinfo:e.app.uinfo})))((function({comments:e,uinfo:t,slug:n,updateComments:r}){const o=ne();return S.createElement("div",{style:o.root},S.createElement("div",{style:o.jiange}),S.createElement("div",{style:o.header},"评论(",e.length,")"),e.length>0?S.createElement("div",null,e.map((e=>S.createElement(S.Fragment,{key:e.id},S.createElement(oe,{data:e,username:t.username,slug:n,updateComments:r}),S.createElement("div",{className:"divider",style:o.divider}))))):S.createElement(ie,null))}));function oe({data:e,username:t,slug:n,updateComments:r}){var o,i,a;console.log(t);const s=ne(),l=C();return S.createElement("div",{className:"f-r",style:s.rowItem},S.createElement("div",{style:s.avatar},S.createElement(te,{src:null==(o=null==e?void 0:e.author)?void 0:o.image,className:"user-img",alt:"",onClick:t=>{var n;t.stopPropagation(),l.push(`/profile/${null==(n=null==e?void 0:e.author)?void 0:n.username}`)}})),S.createElement("div",null,S.createElement("div",{style:s.uname,onClick:t=>{var n;t.stopPropagation(),l.push(`/profile/${null==(n=null==e?void 0:e.author)?void 0:n.username}`)}},null==(i=null==e?void 0:e.author)?void 0:i.username),S.createElement("div",{style:s.body},e.body)),t===(null==(a=null==e?void 0:e.author)?void 0:a.username)?S.createElement("div",{style:s.delBtn,onClick:function(){z.alert("提示","你要删除评论吗?",[{text:"算了",onPress:()=>console.log("cancel"),style:"default"},{text:"删除",onPress:()=>c(this,null,(function*(){(yield function(e){return c(this,arguments,(function*({slug:e,id:t}){try{const n=yield N.delete(`/articles/${e}/comments/${t}`);if(n.status<200||n.status>300)throw new Error("失败");return 1}catch(n){return-1}}))}({slug:n,id:e.id}))<0?P.fail("删除失败"):(P.success("删除成功"),r())}))}])}},"删除"):S.createElement("div",{style:s.delBtn},"关注"))}function ie(){const e=ne();return S.createElement("div",{style:e.empty},"内容为空")}const ae=V((e=>({root:{height:window.innerHeight+"px",backgroundColor:e.bg.pri,overflowY:"scroll"},userImg:{display:"inline-block",marginRight:"14px"},article:{padding:"0 16px",paddingBottom:"56px"},articleContent:{marginTop:"24px"},guanzhu:{color:e.fc.header}})));function se(e){var t,n,r,o;const i=ae(),a=C(),[s,l]=d.exports.useState({}),[u,h]=d.exports.useState([]),p=d.exports.useMemo((()=>u.length),[u]);d.exports.useEffect((()=>{m(),g()}),[]);const f=d.exports.useMemo((()=>Object.keys(s).length>0),[s]),m=d.exports.useCallback((()=>c(this,null,(function*(){var t,n;const r=null==(n=null==(t=null==e?void 0:e.match)?void 0:t.params)?void 0:n.slug;r&&l(yield function(e){return c(this,arguments,(function*({slug:e}){try{return(yield N.get(`/articles/${e}`,{loading:!0})).data.article||{}}catch(t){return{}}}))}({slug:r}))}))),[]),g=d.exports.useCallback((()=>c(this,null,(function*(){var t,n;const r=null==(n=null==(t=null==e?void 0:e.match)?void 0:t.params)?void 0:n.slug;r&&h(yield function(e){return c(this,arguments,(function*({slug:e}){try{return(yield N.get(`/articles/${e}/comments`)).data.comments||[]}catch(t){return[]}}))}({slug:r}))}))),[]);return S.createElement("div",{className:"rvt-headerview article-detail",style:i.root},S.createElement(B,null),f?S.createElement("div",{style:i.article},S.createElement("div",{className:"title"},s.title),S.createElement("div",{className:"f-r j-between a-center"},S.createElement("div",{className:"f-r a-center"},S.createElement(te,{className:"user-img",src:null==(t=null==s?void 0:s.author)?void 0:t.image,style:i.userImg,onClick:e=>{var t;e.stopPropagation(),a.push(`/profile/${null==(t=null==s?void 0:s.author)?void 0:t.username}`)}}),S.createElement("div",null,S.createElement("div",{className:"header",onClick:e=>{var t;e.stopPropagation(),a.push(`/profile/${null==(t=null==s?void 0:s.author)?void 0:t.username}`)}},(null==(n=null==s?void 0:s.author)?void 0:n.username)||"示例昵称"),S.createElement("div",{className:"secd"},s.updateAt||"1小时前"))),S.createElement("div",{style:i.guanzhu},"关注")),S.createElement("div",{className:"content",style:i.articleContent},s.body),S.createElement("div",null,S.createElement(re,{comments:u,slug:null==(o=null==(r=null==e?void 0:e.match)?void 0:r.params)?void 0:o.slug,updateComments:g})),S.createElement(G,{data:s,commentCount:p,updateComments:g})):null)}var le=function(e,t,n,r,o,i,a,s){if(!e){var l;if(void 0===t)l=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var c=[n,r,o,i,a,s],u=0;(l=new Error(t.replace(/%s/g,(function(){return c[u++]})))).name="Invariant Violation"}throw l.framesToPop=1,l}},ce=le;var ue=function(e){if(Array.isArray(e))return 0===e.length;if("object"==typeof e){if(e)for(var t in!function(e){if("undefined"==typeof Symbol)return!1;return e[Symbol.iterator]}(e)||void 0===e.size||ce(!1),e)return!1;return!0}return!e},de=function(){};function he(e,t,n){return e[t][n]}function pe(e,t){return e[t]}var fe=function(){function e(t){p(this,e),le(t&&"function"==typeof t.rowHasChanged,"Must provide a rowHasChanged function."),this._rowHasChanged=t.rowHasChanged,this._getRowData=t.getRowData||he,this._sectionHeaderHasChanged=t.sectionHeaderHasChanged,this._getSectionHeaderData=t.getSectionHeaderData||pe,this._dataBlob=null,this._dirtyRows=[],this._dirtySections=[],this._cachedRowCount=0,this.rowIdentities=[],this.sectionIdentities=[]}return m(e,[{key:"cloneWithRows",value:function(e,t){var n=t?[t]:null;return this._sectionHeaderHasChanged||(this._sectionHeaderHasChanged=function(){return!1}),this.cloneWithRowsAndSections({s1:e},["s1"],n)}},{key:"cloneWithRowsAndSections",value:function(t,n,r){le("function"==typeof this._sectionHeaderHasChanged,"Must provide a sectionHeaderHasChanged function with section data."),le(!n||!r||n.length===r.length,"row and section ids lengths must be the same");var o=new e({getRowData:this._getRowData,getSectionHeaderData:this._getSectionHeaderData,rowHasChanged:this._rowHasChanged,sectionHeaderHasChanged:this._sectionHeaderHasChanged});return o._dataBlob=t,o.sectionIdentities=n||Object.keys(t),r?o.rowIdentities=r:(o.rowIdentities=[],o.sectionIdentities.forEach((function(e){o.rowIdentities.push(Object.keys(t[e]))}))),o._cachedRowCount=function(e){for(var t=0,n=0;n<e.length;n++){t+=e[n].length}return t}(o.rowIdentities),o._calculateDirtyArrays(this._dataBlob,this.sectionIdentities,this.rowIdentities),o}},{key:"getRowCount",value:function(){return this._cachedRowCount}},{key:"getRowAndSectionCount",value:function(){return this._cachedRowCount+this.sectionIdentities.length}},{key:"rowShouldUpdate",value:function(e,t){return this._dirtyRows[e][t]}},{key:"getRowData",value:function(e,t){var n=this.sectionIdentities[e],r=this.rowIdentities[e][t];return this._getRowData(this._dataBlob,n,r)}},{key:"getRowIDForFlatIndex",value:function(e){for(var t=e,n=0;n<this.sectionIdentities.length;n++){if(!(t>=this.rowIdentities[n].length))return this.rowIdentities[n][t];t-=this.rowIdentities[n].length}return null}},{key:"getSectionIDForFlatIndex",value:function(e){for(var t=e,n=0;n<this.sectionIdentities.length;n++){if(!(t>=this.rowIdentities[n].length))return this.sectionIdentities[n];t-=this.rowIdentities[n].length}return null}},{key:"getSectionLengths",value:function(){for(var e=[],t=0;t<this.sectionIdentities.length;t++)e.push(this.rowIdentities[t].length);return e}},{key:"sectionHeaderShouldUpdate",value:function(e){return this._dirtySections[e]}},{key:"getSectionHeaderData",value:function(e){if(!this._getSectionHeaderData)return null;var t=this.sectionIdentities[e];return this._getSectionHeaderData(this._dataBlob,t)}},{key:"_calculateDirtyArrays",value:function(e,t,n){for(var r,o=me(t),i={},a=0;a<n.length;a++){var s=t[a];de(!i[s]),i[s]=me(n[a])}this._dirtySections=[],this._dirtyRows=[];for(var l=0;l<this.sectionIdentities.length;l++){r=!o[s=this.sectionIdentities[l]];var c=this._sectionHeaderHasChanged;!r&&c&&(r=c(this._getSectionHeaderData(e,s),this._getSectionHeaderData(this._dataBlob,s))),this._dirtySections.push(!!r),this._dirtyRows[l]=[];for(var u=0;u<this.rowIdentities[l].length;u++){var d=this.rowIdentities[l][u];r=!o[s]||!i[s][d]||this._rowHasChanged(this._getRowData(e,s,d),this._getRowData(this._dataBlob,s,d)),this._dirtyRows[l].push(!!r)}}}}]),e}();function me(e){if(ue(e))return{};for(var t={},n=0;n<e.length;n++){var r=e[n];de(!t[r]),t[r]=!0}return t}var ge={className:E.string,prefixCls:E.string,listPrefixCls:E.string,listViewPrefixCls:E.string,style:E.object,contentContainerStyle:E.object,onScroll:E.func},ve=function(e){function t(){var e,n,r;p(this,t);for(var o=arguments.length,i=Array(o),a=0;a<o;a++)i[a]=arguments[a];return n=r=f(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),ye.call(r),f(r,n)}return h(t,e),m(t,[{key:"componentWillUpdate",value:function(e){this.props.dataSource===e.dataSource&&this.props.initialListSize===e.initialListSize||!this.handleScroll||(this.props.useBodyScroll?window.removeEventListener("scroll",this.handleScroll):this.ScrollViewRef.removeEventListener("scroll",this.handleScroll))}},{key:"componentDidUpdate",value:function(e){var t=this;this.props.dataSource===e.dataSource&&this.props.initialListSize===e.initialListSize||!this.handleScroll||setTimeout((function(){t.props.useBodyScroll?window.addEventListener("scroll",t.handleScroll):t.ScrollViewRef.addEventListener("scroll",t.handleScroll)}),0)}},{key:"componentDidMount",value:function(){var e,t,n,r,o=this,i=function(e){return o.props.onScroll&&o.props.onScroll(e,o.getMetrics())};this.props.scrollEventThrottle&&(e=i,t=this.props.scrollEventThrottle,n=!0,r=!0,i=function(o){n&&(n=!1,setTimeout((function(){n=!0,e(o)}),t),r&&(e(o),r=!1))}),this.handleScroll=i,this.onLayout=function(){return o.props.onLayout({nativeEvent:{layout:{width:window.innerWidth,height:window.innerHeight}}})},this.props.useBodyScroll?(window.addEventListener("scroll",this.handleScroll),window.addEventListener("resize",this.onLayout)):this.ScrollViewRef.addEventListener("scroll",this.handleScroll)}},{key:"componentWillUnmount",value:function(){this.props.useBodyScroll?(window.removeEventListener("scroll",this.handleScroll),window.removeEventListener("resize",this.onLayout)):this.ScrollViewRef.removeEventListener("scroll",this.handleScroll)}},{key:"render",value:function(){var e=this,t=this.props,n=t.children,r=t.className,o=t.prefixCls,i=t.listPrefixCls,a=t.listViewPrefixCls,s=t.style,l=void 0===s?{}:s,c=t.contentContainerStyle,u=void 0===c?{}:c,d=t.useBodyScroll,h=t.pullToRefresh,p=o||a||"",f={ref:function(t){return e.ScrollViewRef=t||e.ScrollViewRef},style:y({},d?{}:{position:"relative",overflow:"auto",WebkitOverflowScrolling:"touch"},l),className:g(r,p+"-scrollview")},m={ref:function(t){return e.InnerScrollViewRef=t},style:y({position:"absolute",minWidth:"100%"},u),className:g(p+"-scrollview-content",i)},v=function(t){return S.cloneElement(h,{getScrollContainer:t?function(){return document.body}:function(){return e.ScrollViewRef}},n)};return d?h?S.createElement("div",f,v(!0)):S.createElement("div",f,n):h?S.createElement("div",f,S.createElement("div",m,v())):S.createElement("div",f,S.createElement("div",m,n))}}]),t}(S.Component);ve.propTypes=ge;var ye=function(){var e=this;this.getMetrics=function(){var t=!e.props.horizontal;if(e.props.useBodyScroll){var n=document.scrollingElement?document.scrollingElement:document.body;return{visibleLength:window[t?"innerHeight":"innerWidth"],contentLength:e.ScrollViewRef?e.ScrollViewRef[t?"scrollHeight":"scrollWidth"]:0,offset:n[t?"scrollTop":"scrollLeft"]}}return{visibleLength:e.ScrollViewRef[t?"offsetHeight":"offsetWidth"],contentLength:e.ScrollViewRef[t?"scrollHeight":"scrollWidth"],offset:e.ScrollViewRef[t?"scrollTop":"scrollLeft"]}},this.getInnerViewNode=function(){return e.InnerScrollViewRef},this.scrollTo=function(){var t;e.props.useBodyScroll?(t=window).scrollTo.apply(t,arguments):(e.ScrollViewRef.scrollLeft=arguments.length<=0?void 0:arguments[0],e.ScrollViewRef.scrollTop=arguments.length<=1?void 0:arguments[1])}},Se=function(e){function t(){return p(this,t),f(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return h(t,e),m(t,[{key:"shouldComponentUpdate",value:function(e){return e.shouldUpdate}},{key:"render",value:function(){return this.props.render()}}]),t}(S.Component),we=function(e){function t(){var e,n,r;p(this,t);for(var o=arguments.length,i=Array(o),a=0;a<o;a++)i[a]=arguments[a];return n=r=f(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),be.call(r),f(r,n)}return h(t,e),m(t,[{key:"componentWillMount",value:function(){this.scrollProperties={visibleLength:null,contentLength:null,offset:0},this._childFrames=[],this._visibleRows={},this._prevRenderedRowsCount=0,this._sentEndForContentLength=null}},{key:"componentWillReceiveProps",value:function(e){var t=this;this.props.dataSource===e.dataSource&&this.props.initialListSize===e.initialListSize||this.setState((function(n,r){return t._prevRenderedRowsCount=0,{curRenderedRowsCount:Math.min(Math.max(n.curRenderedRowsCount,e.initialListSize),e.dataSource.getRowCount())}}),(function(){return t._renderMoreRowsIfNeeded()}))}},{key:"render",value:function(){for(var e=this,t=this.props.dataSource,n=t.rowIdentities,r=[],o=0,i=0;i<n.length;i++){var a=t.sectionIdentities[i],s=n[i];if(0!==s.length){var l=void 0;if(this.props.renderSectionHeader){var c=o>=this._prevRenderedRowsCount&&t.sectionHeaderShouldUpdate(i);l=S.createElement(Se,{key:"s_"+a,shouldUpdate:!!c,render:this.props.renderSectionHeader.bind(null,t.getSectionHeaderData(i),a)})}for(var u=[],d=0;d<s.length;d++){var h=s[d],p=a+"_"+h,f=o>=this._prevRenderedRowsCount&&t.rowShouldUpdate(i,d),m=S.createElement(Se,{key:"r_"+p,shouldUpdate:!!f,render:this.props.renderRow.bind(null,t.getRowData(i,d),a,h,this.onRowHighlighted)});if(u.push(m),this.props.renderSeparator&&(d!==s.length-1||i===n.length-1)){var g=this.state.highlightedRow.sectionID===a&&(this.state.highlightedRow.rowID===h||this.state.highlightedRow.rowID===s[d+1]),v=this.props.renderSeparator(a,h,g);v&&u.push(v)}if(++o===this.state.curRenderedRowsCount)break}var w=S.cloneElement(this.props.renderSectionBodyWrapper(a),{className:this.props.sectionBodyClassName},u);if(this.props.renderSectionWrapper?r.push(S.cloneElement(this.props.renderSectionWrapper(a),{},l,w)):(r.push(l),r.push(w)),o>=this.state.curRenderedRowsCount)break}}var b=this.props,x=b.renderScrollComponent,C=D(b,["renderScrollComponent"]);return S.cloneElement(x(y({},C,{onScroll:this._onScroll})),{ref:function(t){return e.ListViewRef=t},onContentSizeChange:this._onContentSizeChange,onLayout:this._onLayout},this.props.renderHeader?this.props.renderHeader():null,S.cloneElement(C.renderBodyComponent(),{},r),this.props.renderFooter?this.props.renderFooter():null,C.children)}}]),t}(S.Component);we.DataSource=fe,we.propTypes=y({},ve.propTypes,{dataSource:E.instanceOf(fe).isRequired,renderSeparator:E.func,renderRow:E.func.isRequired,initialListSize:E.number,onEndReached:E.func,onEndReachedThreshold:E.number,pageSize:E.number,renderFooter:E.func,renderHeader:E.func,renderSectionHeader:E.func,renderScrollComponent:E.func,scrollRenderAheadDistance:E.number,onChangeVisibleRows:E.func,scrollEventThrottle:E.number,renderBodyComponent:E.func,renderSectionWrapper:E.func,renderSectionBodyWrapper:E.func,sectionBodyClassName:E.string,listViewPrefixCls:E.string,useBodyScroll:E.bool}),we.defaultProps={initialListSize:10,pageSize:1,renderScrollComponent:function(e){return S.createElement(ve,e)},renderBodyComponent:function(){return S.createElement("div",null)},renderSectionBodyWrapper:function(e){return S.createElement("div",{key:e})},sectionBodyClassName:"list-view-section-body",listViewPrefixCls:"rmc-list-view",scrollRenderAheadDistance:1e3,onEndReachedThreshold:1e3,scrollEventThrottle:50,scrollerOptions:{}};var be=function(){var e=this;this.state={curRenderedRowsCount:this.props.initialListSize,highlightedRow:{}},this.getMetrics=function(){return{contentLength:e.scrollProperties.contentLength,totalRows:e.props.dataSource.getRowCount(),renderedRows:e.state.curRenderedRowsCount,visibleRows:Object.keys(e._visibleRows).length}},this.getInnerViewNode=function(){return e.ListViewRef.getInnerViewNode()},this.scrollTo=function(){var t;e.ListViewRef&&e.ListViewRef.scrollTo&&(t=e.ListViewRef).scrollTo.apply(t,arguments)},this.onRowHighlighted=function(t,n){e.setState({highlightedRow:{sectionID:t,rowID:n}})},this._onContentSizeChange=function(t,n){var r=e.props.horizontal?t:n;r!==e.scrollProperties.contentLength&&(e.scrollProperties.contentLength=r,e._renderMoreRowsIfNeeded()),e.props.onContentSizeChange&&e.props.onContentSizeChange(t,n)},this._onLayout=function(t){var n=t.nativeEvent.layout,r=n.width,o=n.height,i=e.props.horizontal?r:o;i!==e.scrollProperties.visibleLength&&(e.scrollProperties.visibleLength=i,e._renderMoreRowsIfNeeded()),e.props.onLayout&&e.props.onLayout(t)},this._maybeCallOnEndReached=function(t){return!!(e.props.onEndReached&&e.scrollProperties.contentLength!==e._sentEndForContentLength&&e._getDistanceFromEnd(e.scrollProperties)<e.props.onEndReachedThreshold&&e.state.curRenderedRowsCount===e.props.dataSource.getRowCount())&&(e._sentEndForContentLength=e.scrollProperties.contentLength,e.props.onEndReached(t),!0)},this._renderMoreRowsIfNeeded=function(){null!==e.scrollProperties.contentLength&&null!==e.scrollProperties.visibleLength&&e.state.curRenderedRowsCount!==e.props.dataSource.getRowCount()?e._getDistanceFromEnd(e.scrollProperties)<e.props.scrollRenderAheadDistance&&e._pageInNewRows():e._maybeCallOnEndReached()},this._pageInNewRows=function(){e.setState((function(t,n){var r=Math.min(t.curRenderedRowsCount+n.pageSize,n.dataSource.getRowCount());return e._prevRenderedRowsCount=t.curRenderedRowsCount,{curRenderedRowsCount:r}}),(function(){e._prevRenderedRowsCount=e.state.curRenderedRowsCount}))},this._getDistanceFromEnd=function(e){return e.contentLength-e.visibleLength-e.offset},this._onScroll=function(t,n){e.ListViewRef&&(e.scrollProperties=n,e._maybeCallOnEndReached(t)||e._renderMoreRowsIfNeeded(),e.props.onEndReached&&e._getDistanceFromEnd(e.scrollProperties)>e.props.onEndReachedThreshold&&(e._sentEndForContentLength=null),e.props.onScroll&&e.props.onScroll(t))}};function xe(e){window.document.body.scrollTop=e,window.document.documentElement.scrollTop=e}var Ce=function(e){function t(e){p(this,t);var n=f(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return Ee.call(n),n.state={pageSize:e.pageSize,_delay:!1},n}return h(t,e),m(t,[{key:"componentDidMount",value:function(){this.dataChange(this.props),this.getQsInfo()}},{key:"componentWillReceiveProps",value:function(e){this.props.dataSource!==e.dataSource&&this.dataChange(e)}},{key:"componentDidUpdate",value:function(){this.getQsInfo()}},{key:"componentWillUnmount",value:function(){this._timer&&clearTimeout(this._timer),this._hCache=null}},{key:"renderQuickSearchBar",value:function(e,t){var n=this,r=this.props,o=r.dataSource,i=r.prefixCls,a=o.sectionIdentities.map((function(e){return{value:e,label:o._getSectionHeaderData(o._dataBlob,e)}}));return S.createElement("ul",{ref:function(e){return n.quickSearchBarRef=e},className:i+"-quick-search-bar",style:t,onTouchStart:this.onTouchStart,onTouchMove:this.onTouchMove,onTouchEnd:this.onTouchEnd,onTouchCancel:this.onTouchEnd},S.createElement("li",{"data-qf-target":e.value,onClick:function(){return n.onQuickSearchTop(void 0,e.value)}},e.label),a.map((function(e){return S.createElement("li",{key:e.value,"data-qf-target":e.value,onClick:function(){return n.onQuickSearch(e.value)}},e.label)})))}},{key:"render",value:function(){var e,t=this,n=this.state,r=n._delay,o=n.pageSize,i=this.props,a=i.className,s=i.prefixCls,l=i.children,c=i.quickSearchBarTop,u=i.quickSearchBarStyle,d=i.initialListSize,h=void 0===d?Math.min(20,this.props.dataSource.getRowCount()):d,p=i.showQuickSearchIndicator,f=i.renderSectionHeader,m=i.sectionHeaderClassName,w=D(i,["className","prefixCls","children","quickSearchBarTop","quickSearchBarStyle","initialListSize","showQuickSearchIndicator","renderSectionHeader","sectionHeaderClassName"]);return S.createElement("div",{className:s+"-container"},r&&this.props.delayActivityIndicator,S.createElement(we,y({},w,{ref:function(e){return t.indexedListViewRef=e},className:g(s,a),initialListSize:h,pageSize:o,renderSectionHeader:function(e,n){return S.cloneElement(f(e,n),{ref:function(e){return t.sectionComponents[n]=e},className:m||s+"-section-header"})}}),l),this.renderQuickSearchBar(c,u),p?S.createElement("div",{className:g((e={},v(e,s+"-qsindicator",!0),v(e,s+"-qsindicator-hide",!p||!this.state.showQuickSearchIndicator),e)),ref:function(e){return t.qsIndicatorRef=e}}):null)}}]),t}(S.Component);Ce.propTypes=y({},we.propTypes,{children:E.any,prefixCls:E.string,className:E.string,sectionHeaderClassName:E.string,quickSearchBarTop:E.object,quickSearchBarStyle:E.object,onQuickSearch:E.func,showQuickSearchIndicator:E.bool}),Ce.defaultProps={prefixCls:"rmc-indexed-list",quickSearchBarTop:{value:"#",label:"#"},onQuickSearch:function(){},showQuickSearchIndicator:!1,delayTime:100,delayActivityIndicator:""};var Ee=function(){var e=this;this.onQuickSearchTop=function(t,n){e.props.useBodyScroll?xe(0):b.findDOMNode(e.indexedListViewRef.ListViewRef).scrollTop=0,e.props.onQuickSearch(t,n)},this.onQuickSearch=function(t){var n=b.findDOMNode(e.indexedListViewRef.ListViewRef),r=b.findDOMNode(e.sectionComponents[t]);e.props.useBodyScroll?xe(r.getBoundingClientRect().top-n.getBoundingClientRect().top+function(e){var t=0;do{isNaN(e.offsetTop)||(t+=e.offsetTop)}while(e=e.offsetParent);return t}(n)):n.scrollTop+=r.getBoundingClientRect().top-n.getBoundingClientRect().top,e.props.onQuickSearch(t)},this.onTouchStart=function(t){e._target=t.target,e._basePos=e.quickSearchBarRef.getBoundingClientRect(),document.addEventListener("touchmove",e._disableParent,!1),document.body.className=document.body.className+" "+e.props.prefixCls+"-qsb-moving",e.updateIndicator(e._target)},this.onTouchMove=function(t){if(t.preventDefault(),e._target){var n=function(e){return e.touches&&e.touches.length?e.touches[0]:e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:e}(t),r=e._basePos,o=void 0;if(n.clientY>=r.top&&n.clientY<=r.top+e._qsHeight){var i=void 0;if((o=Math.floor((n.clientY-r.top)/e._avgH))in e._hCache&&(i=e._hCache[o][0]),i){var a=i.getAttribute("data-qf-target");e._target!==i&&(e.props.quickSearchBarTop.value===a?e.onQuickSearchTop(void 0,a):e.onQuickSearch(a),e.updateIndicator(i)),e._target=i}}}},this.onTouchEnd=function(){e._target&&(document.removeEventListener("touchmove",e._disableParent,!1),document.body.className=document.body.className.replace(new RegExp("\\s*"+e.props.prefixCls+"-qsb-moving","g"),""),e.updateIndicator(e._target,!0),e._target=null)},this.getQsInfo=function(){var t=e.quickSearchBarRef,n=t.offsetHeight,r=[];[].slice.call(t.querySelectorAll("[data-qf-target]")).forEach((function(e){r.push([e])}));for(var o=n/r.length,i=0,a=0,s=r.length;a<s;a++)i=a*o,r[a][1]=[i,i+o];e._qsHeight=n,e._avgH=o,e._hCache=r},this.sectionComponents={},this.dataChange=function(t){var n=t.dataSource.getRowCount();n&&(e.setState({_delay:!0}),e._timer&&clearTimeout(e._timer),e._timer=setTimeout((function(){e.setState({pageSize:n,_delay:!1},(function(){return e.indexedListViewRef._pageInNewRows()}))}),t.delayTime))},this.updateIndicator=function(t,n){var r=t;r.getAttribute("data-qf-target")||(r=r.parentNode),e.props.showQuickSearchIndicator&&(e.qsIndicatorRef.innerText=r.innerText.trim(),e.setState({showQuickSearchIndicator:!0}),e._indicatorTimer&&clearTimeout(e._indicatorTimer),e._indicatorTimer=setTimeout((function(){e.setState({showQuickSearchIndicator:!1})}),1e3));var o=e.props.prefixCls+"-quick-search-bar-over";e._hCache.forEach((function(e){e[0].className=e[0].className.replace(o,"")})),n||(r.className=r.className+" "+o)},this._disableParent=function(e){e.preventDefault(),e.stopPropagation()}};we.IndexedList=Ce;var Re=M.Item;function _e(e,t){var n=e.renderHeader,r=e.renderFooter,o=e.renderSectionHeader,i=e.renderBodyComponent,a=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&(n[r[o]]=e[r[o]])}return n}(e,["renderHeader","renderFooter","renderSectionHeader","renderBodyComponent"]),s=e.listPrefixCls,l={renderHeader:null,renderFooter:null,renderSectionHeader:null,renderBodyComponent:i||function(){return d.exports.createElement("div",{className:s+"-body"})}};return n&&(l.renderHeader=function(){return d.exports.createElement("div",{className:s+"-header"},n())}),r&&(l.renderFooter=function(){return d.exports.createElement("div",{className:s+"-footer"},r())}),o&&(l.renderSectionHeader=t?function(e,t){return d.exports.createElement("div",null,d.exports.createElement(Re,{prefixCls:s},o(e,t)))}:function(e,t){return d.exports.createElement(Re,{prefixCls:s},o(e,t))}),{restProps:a,extraProps:l}}var ke=we.IndexedList,Te=function(e){function t(){return p(this,t),f(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return h(t,e),m(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.prefixCls,r=t.listPrefixCls,o=_e(this.props,!0),i=o.restProps,a=o.extraProps;return d.exports.createElement(ke,y({ref:function(t){return e.indexedListRef=t},sectionHeaderClassName:n+"-section-header "+r+"-body",sectionBodyClassName:n+"-section-body "+r+"-body"},i,a),this.props.children)}}]),t}(d.exports.Component);Te.defaultProps={prefixCls:"am-indexed-list",listPrefixCls:"am-list",listViewPrefixCls:"am-list-view"};var Ne=function(e){function t(){p(this,t);var e=f(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.scrollTo=function(){var t;return(t=e.listviewRef).scrollTo.apply(t,arguments)},e.getInnerViewNode=function(){return e.listviewRef.getInnerViewNode()},e}return h(t,e),m(t,[{key:"render",value:function(){var e=this,t=_e(this.props,!1),n=t.restProps,r=t.extraProps;return d.exports.createElement(we,y({ref:function(t){return e.listviewRef=t}},n,r))}}]),t}(d.exports.Component);Ne.defaultProps={prefixCls:"am-list-view",listPrefixCls:"am-list"},Ne.DataSource=we.DataSource,Ne.IndexedList=Te;var Le=R(Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:{activateText:"松开立即刷新",deactivateText:"下拉可以刷新",finishText:"完成刷新"}})),He=function(e){function t(){return p(this,t),f(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return h(t,e),m(t,[{key:"shouldComponentUpdate",value:function(e){return e.shouldUpdate}},{key:"render",value:function(){return S.createElement("div",null,this.props.render())}}]),t}(S.Component);function Pe(e,t){e.transform=t,e.webkitTransform=t,e.MozTransform=t}var Ie="undefined"!=typeof navigator&&/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent),Oe="down",ze="up",Be={activate:"release",deactivate:"pull",release:"loading",finish:"finish"},De=!1;try{var Me=Object.defineProperty({},"passive",{get:function(){De=!0}});window.addEventListener("test",null,Me)}catch(nt){}var je=!!De&&{passive:!1},Ve=function(e){function t(){p(this,t);var e=f(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.state={currSt:"deactivate",dragOnEdge:!1},e._isMounted=!1,e.shouldUpdateChildren=!1,e.triggerPullToRefresh=function(){!e.state.dragOnEdge&&e._isMounted&&(e.props.refreshing?(e.props.direction===ze&&(e._lastScreenY=-e.props.distanceToRefresh-1),e.props.direction===Oe&&(e._lastScreenY=e.props.distanceToRefresh+1),e.setState({currSt:"release"},(function(){return e.setContentStyle(e._lastScreenY)}))):e.setState({currSt:"finish"},(function(){return e.reset()})))},e.init=function(t){t&&(e._to={touchstart:e.onTouchStart.bind(e,t),touchmove:e.onTouchMove.bind(e,t),touchend:e.onTouchEnd.bind(e,t),touchcancel:e.onTouchEnd.bind(e,t)},Object.keys(e._to).forEach((function(n){t.addEventListener(n,e._to[n],je)})))},e.destroy=function(t){e._to&&t&&Object.keys(e._to).forEach((function(n){t.removeEventListener(n,e._to[n])}))},e.onTouchStart=function(t,n){e._ScreenY=e._startScreenY=n.touches[0].screenY,e._startScreenX=n.touches[0].screenX,e._lastScreenY=e._lastScreenY||0},e.isEdge=function(t,n){var r=e.props.getScrollContainer();if(r&&r===document.body){var o=document.scrollingElement?document.scrollingElement:document.body;if(n===ze)return o.scrollHeight-o.scrollTop<=window.innerHeight;if(n===Oe)return o.scrollTop<=0}return n===ze?t.scrollHeight-t.scrollTop===t.clientHeight:n===Oe?t.scrollTop<=0:void 0},e.damping=function(t){return Math.abs(e._lastScreenY)>e.props.damping?0:t*=(1-Math.abs(e._ScreenY-e._startScreenY)/window.screen.height)*e.props.scale},e.onTouchMove=function(t,n){var r=n.touches[0].screenY,o=n.touches[0].screenX,i=e.props.direction;if(!(Math.abs(o-e._startScreenX)>20*window.devicePixelRatio)&&!(i===ze&&e._startScreenY<r||i===Oe&&e._startScreenY>r)&&e.isEdge(t,i)){e.state.dragOnEdge||(e._ScreenY=e._startScreenY=n.touches[0].screenY,e.setState({dragOnEdge:!0})),n.preventDefault();var a=Math.round(r-e._ScreenY);e._ScreenY=r,e._lastScreenY+=e.damping(a),e.setContentStyle(e._lastScreenY),Math.abs(e._lastScreenY)<e.props.distanceToRefresh?"deactivate"!==e.state.currSt&&e.setState({currSt:"deactivate"}):"deactivate"===e.state.currSt&&e.setState({currSt:"activate"}),Ie&&n.changedTouches[0].clientY<0&&e.onTouchEnd()}},e.onTouchEnd=function(){e.state.dragOnEdge&&e.setState({dragOnEdge:!1}),"activate"===e.state.currSt?(e.setState({currSt:"release"}),e._timer=setTimeout((function(){e.props.refreshing||e.setState({currSt:"finish"},(function(){return e.reset()})),e._timer=void 0}),1e3),e.props.onRefresh()):e.reset()},e.reset=function(){e._lastScreenY=0,e.setContentStyle(0)},e.setContentStyle=function(t){e.contentRef&&Pe(e.contentRef.style,"translate3d(0px,"+t+"px,0)")},e}return h(t,e),m(t,[{key:"shouldComponentUpdate",value:function(e){return this.shouldUpdateChildren=this.props.children!==e.children,!0}},{key:"componentDidUpdate",value:function(e){e!==this.props&&e.refreshing!==this.props.refreshing&&this.triggerPullToRefresh()}},{key:"componentDidMount",value:function(){var e=this;setTimeout((function(){e.init(e.props.getScrollContainer()||e.containerRef),e.triggerPullToRefresh(),e._isMounted=!0}))}},{key:"componentWillUnmount",value:function(){this.destroy(this.props.getScrollContainer()||this.containerRef)}},{key:"render",value:function(){var e=this,t=y({},this.props);delete t.damping;var n=t.className,r=t.prefixCls,o=t.children,i=t.getScrollContainer,a=t.direction;t.onRefresh,t.refreshing;var s=t.indicator;t.distanceToRefresh;var l=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&(n[r[o]]=e[r[o]])}return n}(t,["className","prefixCls","children","getScrollContainer","direction","onRefresh","refreshing","indicator","distanceToRefresh"]),c=S.createElement(He,{shouldUpdate:this.shouldUpdateChildren,render:function(){return o}}),u=function(t){var n=g(t,!e.state.dragOnEdge&&r+"-transition");return S.createElement("div",{className:r+"-content-wrapper"},S.createElement("div",{className:n,ref:function(t){return e.contentRef=t}},a===ze?c:null,S.createElement("div",{className:r+"-indicator"},s[e.state.currSt]||Be[e.state.currSt]),a===Oe?c:null))};return i()?u(r+"-content "+r+"-"+a):S.createElement("div",y({ref:function(t){return e.containerRef=t},className:g(n,r,r+"-"+a)},l),u(r+"-content"))}}]),t}(S.Component);Ve.defaultProps={prefixCls:"rmc-pull-to-refresh",getScrollContainer:function(){},direction:Oe,distanceToRefresh:25,damping:100,indicator:Be,scale:.6};var Fe=function(e){function t(){return p(this,t),f(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return h(t,e),m(t,[{key:"render",value:function(){var e=j(this.props,this.context,"PullToRefresh",(function(){return Le})),t=e.activateText,n=e.deactivateText,r=e.finishText,o=y({activate:t,deactivate:n,release:d.exports.createElement(_,{type:"loading"}),finish:r},this.props.indicator);return d.exports.createElement(Ve,y({},this.props,{indicator:o}))}}]),t}(d.exports.Component);function qe(e){return S.createElement(Fe,s({},e))}Fe.defaultProps={prefixCls:"am-pull-to-refresh"},Fe.contextTypes={antLocale:k.exports.object};class We extends d.exports.Component{constructor(){super(...arguments),l(this,"state",{dataSource:new Ne.DataSource({rowHasChanged:(e,t)=>e!==t}),refreshing:!0,isLoading:!0,pagination:this.props.defaultPagination||{pageNum:0,pageSize:20,total:0},height:0}),l(this,"rData",[]),l(this,"calcRef",d.exports.createRef()),l(this,"onResize",(()=>{const e=this.calcRef.current.getBoundingClientRect().top,t=window.innerHeight;this.setState({height:t-e-(this.props.offset?50:0)})})),l(this,"getData",((...e)=>c(this,[...e],(function*(e=this.state.pagination.pageNum+1,t=this.state.pagination.pageSize){const{getDataMethod:n}=this.props,{list:r,total:o}=yield n({pageNum:e,pageSize:t});if(console.log(r,"hahaha"),0===e)return this.rData=[...r],void this.setState({dataSource:new Ne.DataSource({rowHasChanged:(e,t)=>e!==t}).cloneWithRows(r),refreshing:!1,isLoading:!1,pagination:{total:o,pageNum:e,pageSize:t}});r.length>0?(this.rData=[...this.rData,...r],this.setState({dataSource:this.state.dataSource.cloneWithRows(this.rData),refreshing:!1,isLoading:!1,pagination:{total:o,pageNum:e,pageSize:t}})):this.setState({refreshing:!1,isLoading:!1})})))),l(this,"onRefresh",(()=>{this.setState({refreshing:!0,isLoading:!0}),this.getData(0)})),l(this,"onEndReached",(()=>{this.state.isLoading||this.rData.length>=this.state.pagination.total||(this.setState({isLoading:!0}),this.getData())}))}componentDidMount(){this.props.apiRef&&(this.props.apiRef.current={getData:this.getData}),this.getData(0),this.onResize(),window.addEventListener("resize",this.onResize)}componentWillUnmount(){window.removeEventListener("resize",this.onResize)}render(){const{dataSource:e,pagination:t,refreshing:n,isLoading:r}=this.state,{renderRow:o,contentContainerStyle:i={},renderSeparator:a=((e,t)=>S.createElement("div",{key:`${e}-${t}`,className:"list-gap"}))}=this.props;return S.createElement("div",{ref:this.calcRef,className:"pull-list"},S.createElement(Ne,{dataSource:e,contentContainerStyle:i,renderFooter:()=>S.createElement("div",{className:"pull-list-footer"},r?"加载中...":"已经没有更多数据了"),renderRow:o,renderSeparator:a,useBodyScroll:!1,style:{height:this.state.height+"px"},pullToRefresh:S.createElement(qe,{refreshing:n,onRefresh:this.onRefresh}),onEndReached:this.onEndReached,pageSize:t.pageSize}))}}const Ye=V((e=>({contentContainerStyle:{boxSizing:"border-box"},root:{backgroundColor:e.bg.pri,padding:"16px",borderBottom:"1px solid rgba(57, 60, 67, 0.08)"},userImg:{display:"inline-block",marginRight:"14px"},actionBar:{marginTop:"16px"},icon1:{fontSize:"14px",color:e.fc.desc,marginRight:"40px"},guanzhu:{color:e.fc.header}})));function Ae({query:e,offset:t}){const n=Ye(),r=d.exports.useRef(null),o=C();d.exports.useEffect((()=>{r.current.getData(0)}),[e]);const i=d.exports.useCallback((t=>c(this,null,(function*(){return yield function(e){return c(this,arguments,(function*({tag:e,author:t,favorited:n,pageSize:r=20,pageNum:o=0}){try{const i=yield N.get("/articles",{params:{tag:e,author:t,favorited:n,limit:r,offset:o},loading:!0});return{list:i.data.articles,total:i.data.articlesCount}}catch(nt){return{list:[],total:0}}}))}(s(s({},t),e))}))),[e]),a=d.exports.useCallback((e=>{if(!e.slug)return P.info("没有slug");o.push(`/posts/${e.slug}`)}),[]),l=d.exports.useMemo((()=>(e,t,r)=>{var i,l;return S.createElement("div",{className:"article-row-item",style:n.root,onClick:()=>a(e)},S.createElement("div",{className:"f-r j-between a-center"},S.createElement("div",{className:"f-r a-center",onClick:t=>{var n;t.stopPropagation(),o.push(`/profile/${null==(n=null==e?void 0:e.author)?void 0:n.username}`)}},S.createElement(te,{className:"user-img",src:null==(i=null==e?void 0:e.author)?void 0:i.image,style:n.userImg}),S.createElement("div",null,S.createElement("div",{className:"header"},(null==(l=null==e?void 0:e.author)?void 0:l.username)||"示例昵称"),S.createElement("div",{className:"secd"},e.updateAt||"1小时前"))),S.createElement("div",{style:n.guanzhu},"关注")),S.createElement("div",{className:"title"},e.title||"我是一个标题"),S.createElement("div",{className:"content hidecontent"},e.description||Ue),S.createElement("div",{className:"f-r j-end",style:n.actionBar},S.createElement("div",{className:"f-r j-center a-center",onClick:e=>e.stopPropagation()},S.createElement(W,{style:n.icon1})),S.createElement(X,s({},e))))}),[n]),u=d.exports.useMemo((()=>(e,t)=>S.createElement("div",{key:`${e}-${t}`,className:"article-list-gap"})),[]);return S.createElement("div",null,S.createElement(We,{apiRef:r,offset:t,getDataMethod:i,renderRow:l,renderSeparator:u,contentContainerStyle:n.contentContainerStyle}))}const Ue="你知道吗，每刷新1次，你的页面就变成了新的，刷新2次，就会变2次",Qe=V((e=>({tabBarTextStyle:{padding:0,height:"36px",lineHeight:"36px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",display:"block",textAlign:"center",fontSize:"14px"}})));function $e(){const[e,r]=d.exports.useState([]),[o,i]=d.exports.useState({});d.exports.useEffect((()=>{!function(){c(this,null,(function*(){r(yield function(){return c(this,null,(function*(){try{return(yield N.get("/tags")).data.tags}catch(nt){return[]}}))}())}))}()}),[]);const a=d.exports.useCallback((({title:e})=>{const r="全部"===e?null:e;var a;i((a=s({},o),t(a,n({tag:r}))))}),[o]);return S.createElement("div",{className:"rvt-tabview"},S.createElement("div",{className:"am-navbar"},S.createElement(Xe,{tags:e,onTabChange:a})),S.createElement("div",{style:{paddingTop:"36px",boxSizing:"border-box"}},S.createElement(Ae,{query:o,offset:!0})))}function Xe({tags:e,onTabChange:t}){const n=Qe(),r=d.exports.useMemo((()=>[{title:"全部"},...e.map((e=>({title:e})))]),[e]);return S.createElement(T,{tabs:r,tabBarTextStyle:n.tabBarTextStyle,initialPage:0,onChange:t})}var Ke=u(d.exports.createElement("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"}));const Ge=V((e=>({root:{paddingTop:"36px"},tabBarTextStyle:{padding:0,height:"36px",lineHeight:"36px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",display:"block",textAlign:"center",fontSize:"14px"}})));function Je(e){const t=Ge();return S.createElement("div",{style:t.root},S.createElement(B,{title:"我的文章"}),S.createElement(Ze,{username:F.getState().app.uinfo.username,type:e.match.params.type}))}function Ze({username:e,type:t="0"}){const n=Ge(),[r,o]=d.exports.useState("0"===t?{author:e}:{favorited:e}),i=d.exports.useCallback((({title:t})=>{"我的文章"===t?o({author:e}):"我喜欢的文章"===t&&o({favorited:e})}),[]);return S.createElement("div",null,S.createElement(T,{tabs:[{title:"我的文章"},{title:"我喜欢的文章"}],tabBarTextStyle:n.tabBarTextStyle,initialPage:Number(t),onChange:i}),S.createElement(Ae,{query:r,offset:!0}))}const et=V((e=>({header:{position:"relative",height:"20vh",backgroundImage:"url(/assets/maoboli.2da01a31.jpeg)",backgroundSize:"cover"},backBtn:{position:"absolute",fontSize:"18px",top:"16px",left:"16px",color:"#fff"},viteImg:{height:"50%",objectFit:"contain"},profileDiv:{padding:"16px",backgroundColor:e.bg.pri,position:"relative"},avatar:{boxSizing:"border-box",border:`3px solid ${e.bg.pri}`,position:"absolute",top:"-32px",left:"16px"},editBtn:{fontSize:"12px",color:"#56ba68",height:"24px",lineHeight:"24px",padding:"0 8px",borderRadius:"12px",border:"1px solid #56ba68"},username:{fontSize:"18px",color:e.fc.header,marginBottom:"6px"},bio:{fontSize:"14px",color:e.fc.text}})));function tt(e){const t=et(),n=C(),[r,o]=d.exports.useState({});d.exports.useEffect((()=>{i()}),[]);const i=d.exports.useCallback((()=>c(this,null,(function*(){o(yield function(e){return c(this,arguments,(function*({username:e}){try{return(yield N.get(`/profiles/${e}`)).data.profile}catch(nt){return{}}}))}({username:e.match.params.username}))}))),[]);return S.createElement("div",null,S.createElement("div",{style:t.header,className:"f-r j-center a-center"},S.createElement(Ke,{style:t.backBtn,onClick:n.goBack}),S.createElement("img",{style:t.viteImg,src:"/assets/favicon.17e50649.svg"})),S.createElement("div",{style:t.profileDiv},S.createElement(te,{className:"user-img lg",style:t.avatar,src:r.image}),S.createElement("div",{className:"f-r j-end"},S.createElement("div",{style:t.editBtn},"编辑资料")),S.createElement("div",null,S.createElement("div",{style:t.username},r.username||"..."),S.createElement("div",{style:t.bio},r.bio||"暂无简介"))),S.createElement(Ze,{username:e.match.params.username}))}export{Je as MyArticles,se as Posts,tt as Profile,$e as default};
